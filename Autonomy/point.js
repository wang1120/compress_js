define([],function(){function e(e){var l=this;this._globe=e;this._viewer=e._viewer;this._globeId=e._globeId;this._minHeight=0;this._maxHeight=1e6;this._catalog="default";this._subcatalog="default";this._layer=[];this._options={draw:false,minHeight:0,maxHeight:1e6,catalog:"default",subcatalog:"default",handlerCallback:null,options:null};this._viewer.scene.postRender.addEventListener(function(){var e=0;var a=l._viewer.scene.mode;if(a==Cesium.SceneMode.SCENE3D){var r=Cesium.Cartographic.fromCartesian(l._viewer.scene.camera.position);e=r.height}else{e=Math.ceil(l._viewer.camera.positionCartographic.height)}for(var t=0;t<l._layer.length;t++){if(e>=l._layer[t].minHeight&&e<=l._layer[t].maxHeight){l._layer[t].showHeight=true}else{l._layer[t].showHeight=false}if(l._layer[t].showHeight&&l._layer[t].showLayer&&l._layer[t].showEntity){l._layer[t].show=true}else{l._layer[t].show=false}}});this._handler=new Cesium.ScreenSpaceEventHandler(this._viewer.scene.canvas);this._handler.setInputAction(function(e){var a=l._globe.getLonLatByPosition(e.position);if(l._options.draw){var r={};for(var t in l._options.options){if(t!="color"&&t!="layer"){r[t]=typeof l._options.options[t]==="object"?deepCoyp(l._options.options[t]):l._options.options[t]}}r.lon=a.lon;r.lat=a.lat;r.alt=a.alt;r.layer=l._options.options.layer?l._options.options.layer:null;var i=l.add(r);if(l._options.handlerCallback){l._options.handlerCallback(i)}}},Cesium.ScreenSpaceEventType.LEFT_CLICK)}e.prototype.add=function(e){var a=this;var r=e.mid?e.mid:"";var t=e.name?e.name:"default";var i=e.lon?parseFloat(e.lon):0;var l=e.lat?parseFloat(e.lat):0;var o=e.alt?parseFloat(e.alt):0;var n=e.callback?e.callback:null;var s=e.setMenu?e.setMenu:null;var _=e.description?e.description:"";var h=e.catalog?e.catalog:a._catalog;var c=e.subcatalog?e.subcatalog:a._subcatalog;var v=e.minHeight?e.minHeight:a._minHeight;var g=e.maxHeight?e.maxHeight:a._maxHeight;var y=Cesium.Cartesian3.fromDegrees(i,l);var p=e.leftClick?e.leftClick:null;var u=e.rightClick?e.rightClick:null;var m;var f=e.clampMode?e.clampMode:0;if(f==1){m=Cesium.HeightReference.RELATIVE_TO_GROUND;y=Cesium.Cartesian3.fromDegrees(i,l)}else{m=Cesium.HeightReference.NONE;y=Cesium.Cartesian3.fromDegrees(i,l,o)}var d={lon:i,lat:l,alt:o};var C=a._viewer.entities.add({mid:r,name:t,callback:n,setMenu:s,description:_,options:e,position:y,markPoint:d,catalog:h,subcatalog:c,minHeight:v,maxHeight:g,showHeight:true,showLayer:true,showEntity:true,leftClick:p,rightClick:u,point:{color:Cesium.Color.RED,pixelSize:18,heightReference:m}});a._layer[a._layer.length]=C;var w=(new Date).getTime()+"a"+parseInt(100*Math.random());a._globe.layerManager._add("entityLayer",w,h,c);return C};e.prototype.drawHandler=function(e){var a=this;a._options.draw=true;a._options.options=e;var r=e.handlerCallback?e.handlerCallback:null;a._options.handlerCallback=r};e.prototype.deactivateHandler=function(){var e=this;e._options.draw=false};e.prototype.remove=function(e){var a=this;for(var r=a._layer.length-1;r>=0;r--){if(a._layer[r]==e){var t=a._layer[r].catalog;var i=a._layer[r].subcatalog;var l=a._viewer.entities.remove(e);a._layer.splice(r,1);a._globe.layerManager._remove("entityLayer",t,i);return l}}};e.prototype.removeByMid=function(e){var a=this;var r=true;for(var t=a._layer.length-1;t>=0;t--){if(a._layer[t].mid==e){var i=a._layer[t].catalog;var l=a._layer[t].subcatalog;r=a._viewer.entities.remove(a._layer[t]);a._layer.splice(t,1);a._globe.layerManager._remove("entityLayer",i,l);if(!r){return r}}}return r};e.prototype.removeByName=function(e){var a=this;var r=true;for(var t=a._layer.length-1;t>=0;t--){if(a._layer[t].name==e){var i=a._layer[t].catalog;var l=a._layer[t].subcatalog;r=a._viewer.entities.remove(a._layer[t]);a._layer.splice(t,1);a._globe.layerManager._remove("entityLayer",i,l);if(!r){return r}}}return r};e.prototype.getByMid=function(e){var a=this;var r=[];for(var t=a._layer.length-1;t>=0;t--){if(a._layer[t].mid==e){r[r.length]=a._layer[t]}}return r};e.prototype.getByName=function(e){var a=this;var r=[];for(var t=a._layer.length-1;t>=0;t--){if(a._layer[t].name==e){r[r.length]=a._layer[t]}}return r};return e});