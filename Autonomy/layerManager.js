define([],function(){function e(e){var r=this;this._globe=e;this._viewer=e._viewer;this._globeId=e._globeId;this._layer_manager_bottom;this._layer_manager_top;this._layerManager=[{id:"entityLayer",title:"标绘图层",subset:[]},{id:"globeLayer",title:"影像图层",subset:[]},{id:"vectorLayer",title:"业务图层",subset:[]}];if(!this._globe._showBottomInfo){return}this._loadLayerManager();this._viewer.scene.postRender.addEventListener(function(){var e=r._viewer._lastHeight;var a=r._viewer.scene.canvas.height;var l=e-a;if(r._layer_manager_bottom){r._layer_manager_bottom.setAttribute("style","bottom: "+l+"px;")}if(r._layer_manager_top){r._layer_manager_top.setAttribute("style","bottom: "+(l+27)+"px;")}});var a=new Cesium.ScreenSpaceEventHandler(r._viewer.scene.canvas);a.setInputAction(function(e){r._closeManager()},Cesium.ScreenSpaceEventType.LEFT_CLICK)}e.prototype._loadLayerManager=function(){var e=this;if(!e._globe._showBottomInfo){return}e._layer_manager_bottom=document.createElement("div");e._layer_manager_bottom.setAttribute("class","cfglobe-layer-manager-bottom");e._layer_manager_bottom.setAttribute("id","cfglobe_layer_manager_bottom");e._layer_manager_bottom.innerHTML="图层管理器  ▲";e._layer_manager_bottom.onclick=function(){e._showManager(this)};document.getElementById(e._globeId).getElementsByTagName("div")[0].appendChild(e._layer_manager_bottom);e._layer_manager_top=document.createElement("div");e._layer_manager_top.setAttribute("id","cfglobe_layer_manager-top");e._layer_manager_top.setAttribute("class","cfglobe-layer-manager-top-hide");document.getElementById(e._globeId).getElementsByTagName("div")[0].appendChild(e._layer_manager_top);var a=document.createElement("div");a.setAttribute("id","cfglobe_layer_manager_list");a.setAttribute("class","cfglobe-layer-manager-list");e._layer_manager_top.appendChild(a);for(var l=0;l<e._layerManager.length;l++){var r=document.createElement("div");r.setAttribute("class","cfglobe-layer-info");if(l==0){r.setAttribute("style","border-top: 0;")}var t=document.createElement("input");t.setAttribute("type","checkbox");t.setAttribute("id","cfglobe_layer_checkbox_"+e._layerManager[l].id);t.onclick=function(){e._layerCheckManager(1,this)};t.checked=true;r.appendChild(t);var o=document.createElement("span");o.innerHTML=e._layerManager[l].title;r.appendChild(o);var _=document.createElement("button");_.setAttribute("id","cfglobe_layer_button_"+e._layerManager[l].id);_.innerHTML="▼";_.onclick=function(){e._layerListManager(this)};r.appendChild(_);a.appendChild(r);var g=document.createElement("div");g.setAttribute("id","cfglobe_layer_"+e._layerManager[l].id);g.setAttribute("style","display: none; padding-bottom: 10px;");a.appendChild(g)}};e.prototype._showManager=function(e){var a=this;if(!a._globe._showBottomInfo){return}if(e.innerHTML=="图层管理器  ▼"){document.getElementById("cfglobe_layer_manager-top").setAttribute("class","cfglobe-layer-manager-top-hide");e.innerHTML="图层管理器  ▲"}else{document.getElementById("cfglobe_layer_manager-top").setAttribute("class","cfglobe-layer-manager-top-show");e.innerHTML="图层管理器  ▼"}};e.prototype._closeManager=function(){document.getElementById("cfglobe_layer_manager-top").setAttribute("class","cfglobe-layer-manager-top-hide");document.getElementById("cfglobe_layer_manager_bottom").innerHTML="图层管理器  ▲"};e.prototype._layerListManager=function(e){var a=this;if(!a._globe._showBottomInfo){return}if(e.innerHTML=="▼"){document.getElementById("cfglobe_layer_"+e.id.replace("cfglobe_layer_button_","")).style.display="block";e.innerHTML="▲"}else{document.getElementById("cfglobe_layer_"+e.id.replace("cfglobe_layer_button_","")).style.display="none";e.innerHTML="▼"}};e.prototype._add=function(e,a,l,r,t){var o=this;if(!o._globe._showBottomInfo){return}var _=true;if(typeof t==="boolean"){_=t}if(e=="entityLayer"){var g=true;var n=true;var b="";for(var i=0;i<o._layerManager[0].subset.length;i++){if(o._layerManager[0].subset[i].title==l){g=false;if(b==""){b=o._layerManager[0].subset[i].fid}if(o._layerManager[0].subset[i].subtitle==r){n=false}}}if(g||n){if(b==""){b=a}var s={layer:a,title:l,subtitle:r,fid:b};o._layerManager[0].subset[o._layerManager[0].subset.length]=s}if(g){var y=document.getElementById("cfglobe_layer_"+e);var c=document.createElement("div");c.setAttribute("class","cfglobe-layer-list");c.setAttribute("id","cfglobe_layer_div_"+e+"splitLayer"+a);var u=document.createElement("input");u.setAttribute("type","checkbox");u.setAttribute("id","cfglobe_layer_checkbox_"+e+"splitLayer"+a);u.onclick=function(){o._layerCheckManager(2,this)};u.setAttribute("checked","true");c.appendChild(u);var f=document.createElement("span");f.innerHTML=l;c.appendChild(f);if(n){var p=document.createElement("div");p.setAttribute("class","cfglobe-layer-list-catalog");var d=document.createElement("input");d.setAttribute("type","checkbox");d.setAttribute("id","cfglobe_layer_checkbox_"+e+"splitSubLayer"+a);d.onclick=function(){o._layerCheckManager(3,this)};d.setAttribute("checked","true");p.appendChild(d);var h=document.createElement("span");h.setAttribute("id","cfglobe_layer_span_"+e+"splitLayer"+a);h.innerHTML=r;h.onclick=function(){o._layerSelectManager(this)};p.appendChild(h);c.appendChild(p)}y.appendChild(c);var v=document.getElementById("cfglobe_layer_checkbox_"+e);v.checked=true}else if(n){var p=document.createElement("div");p.setAttribute("class","cfglobe-layer-list-catalog");var d=document.createElement("input");d.setAttribute("type","checkbox");d.setAttribute("id","cfglobe_layer_checkbox_"+e+"splitSubLayer"+a);d.onclick=function(){o._layerCheckManager(3,this)};d.setAttribute("checked","true");p.appendChild(d);var h=document.createElement("span");h.setAttribute("id","cfglobe_layer_span_"+e+"splitLayer"+a);h.innerHTML=r;h.onclick=function(){o._layerSelectManager(this)};p.appendChild(h);var c=document.getElementById("cfglobe_layer_div_"+e+"splitLayer"+b);c.appendChild(p)}}else{var s={layer:a,title:l};if(e=="globeLayer"){o._layerManager[1].subset[o._layerManager[1].subset.length]=s}else if(e=="vectorLayer"){o._layerManager[2].subset[o._layerManager[2].subset.length]=s}var y=document.getElementById("cfglobe_layer_"+e);var c=document.createElement("div");c.setAttribute("class","cfglobe-layer-list");var u=document.createElement("input");u.setAttribute("type","checkbox");u.checked=_;u.setAttribute("id","cfglobe_layer_checkbox_"+e+"splitLayer"+a);u.onclick=function(){o._layerCheckManager(2,this)};c.appendChild(u);var f=document.createElement("span");f.innerHTML=l;c.appendChild(f);y.appendChild(c);var v=document.getElementById("cfglobe_layer_checkbox_"+e);v.checked=true}};e.prototype._layerCheckManager=function(e,a){var l=this;if(!l._globe._showBottomInfo){return}var r=a.checked;if(e=="1"){var t=a.id.replace("cfglobe_layer_checkbox_","");var o=document.getElementById("cfglobe_layer_"+t).getElementsByTagName("div");for(var _=0;_<o.length;_++){var g=o[_].getElementsByTagName("input")[0];g.checked=r}if(t=="globeLayer"){var n=l._globe.globeLayer._layerList;for(var _=0;_<n.length;_++){n[_].show=r}}else if(t=="vectorLayer"){var b=l._globe.globeLayer._vectorLayerList;for(var _=0;_<b.length;_++){b[_].show=r}}else if(t=="shpLayer"){var i=l._globe.shpParser._layer;for(var _=0;_<i.length;_++){i[_].show=r}}else if(t=="entityLayer"){for(var _=0;_<l._layerManager[0].subset.length;_++){var s=l._layerManager[0].subset[_].title;var y=l._layerManager[0].subset[_].subtitle;l._setShowByCatalog(s,y,r)}}}else if(e=="2"){var t=a.id.replace("cfglobe_layer_checkbox_","").split("splitLayer")[0];var c=a.id.replace("cfglobe_layer_checkbox_","").split("splitLayer")[1];if(t=="globeLayer"){var n=l._globe.globeLayer._layerList;for(var _=0;_<n.length;_++){if(n[_].lid==c){n[_].show=r}}}else if(t=="vectorLayer"){var b=l._globe.globeLayer._vectorLayerList;for(var _=0;_<b.length;_++){if(b[_].lid==c){b[_].show=r}}}else if(t=="shpLayer"){var i=l._globe.shpParser._layer;for(var _=0;_<i.length;_++){if(i[_].lid==c){i[_].show=r}}}else if(t=="entityLayer"){var o=document.getElementById("cfglobe_layer_div_"+t+"splitLayer"+c).getElementsByTagName("div");for(var _=0;_<o.length;_++){var g=o[_].getElementsByTagName("input")[0];g.checked=r}var s="";for(var _=0;_<l._layerManager[0].subset.length;_++){if(c==l._layerManager[0].subset[_].layer){s=l._layerManager[0].subset[_].title;break}}for(var _=0;_<l._layerManager[0].subset.length;_++){if(s==l._layerManager[0].subset[_].title){var y=l._layerManager[0].subset[_].subtitle;l._setShowByCatalog(s,y,r)}}}var u=false;var f=document.getElementById("cfglobe_layer_"+t).getElementsByTagName("div");for(var _=0;_<f.length;_++){var g=f[_].getElementsByTagName("input")[0];if(g.checked){u=true}}document.getElementById("cfglobe_layer_checkbox_"+t).checked=u}else if(e=="3"){var s="";var y="";var c=a.id.replace("cfglobe_layer_checkbox_","").split("splitSubLayer")[1];for(var _=0;_<l._layerManager[0].subset.length;_++){if(c==l._layerManager[0].subset[_].layer){s=l._layerManager[0].subset[_].title;y=l._layerManager[0].subset[_].subtitle;l._setShowByCatalog(s,y,r);break}}}};e.prototype._layerSelectManager=function(e){var a=this;if(!a._globe._showBottomInfo){return}var l=e.id.replace("cfglobe_layer_span_","").split("splitLayer")[1];var r="";var t="";for(var o=0;o<a._layerManager[0].subset.length;o++){if(a._layerManager[0].subset[o].layer==l){r=a._layerManager[0].subset[o].title;t=a._layerManager[0].subset[o].subtitle;break}}var _=a._getUntityByName(r,t);if(_){if(_.isMark){var g=_.markPoint;var n={lon:g.lon,lat:g.lat,alt:3e3};a._globe.flyTo(n)}else{a._viewer.flyTo(_)}}};e.prototype._getUntityByName=function(e,a){var l=this;if(!l._globe._showBottomInfo){return}for(var r=0;r<l._globe.placeMark._layer.length;r++){if(l._globe.placeMark._layer[r].catalog==e&&l._globe.placeMark._layer[r].subcatalog==a){var t=l._globe.placeMark._layer[r];t.isMark=true;return t}}for(var r=0;r<l._globe.placeMark._layer_dataSource.length;r++){if(l._globe.placeMark._layer_dataSource[r].catalog==e&&l._globe.placeMark._layer_dataSource[r].subcatalog==a){var t=l._globe.placeMark._layer_dataSource[r];t.isMark=true;return t}}for(var r=0;r<l._globe.model._layer.length;r++){if(l._globe.model._layer[r].catalog==e&&l._globe.model._layer[r].subcatalog==a){return l._globe.model._layer[r]}}for(var r=0;r<l._globe.particle._layer.length;r++){if(l._globe.particle._layer[r].catalog==e&&l._globe.particle._layer[r].subcatalog==a){return l._globe.particle._layer[r]}}for(var r=0;r<l._globe.point._layer.length;r++){if(l._globe.point._layer[r].catalog==layer&&l._globe.point._layer[r].subcatalog==sublayer){return l._globe.point._layer[r]}}for(var r=0;r<l._globe.polyline._layer.length;r++){if(l._globe.polyline._layer[r].catalog==e&&l._globe.polyline._layer[r].subcatalog==a){return l._globe.polyline._layer[r].polyline}}for(var r=0;r<l._globe.polygon._layer.length;r++){if(l._globe.polygon._layer[r].catalog==e&&l._globe.polygon._layer[r].subcatalog==a){return l._globe.polygon._layer[r].polygon}}for(var r=0;r<l._globe.freeline._layer.length;r++){if(l._globe.freeline._layer[r].catalog==layer&&l._globe.freeline._layer[r].subcatalog==sublayer){return l._globe.freeline._layer[r].freeline}}for(var r=0;r<l._globe.arrow._layer.subset.length;r++){if(l._globe.arrow._layer.subset[r].catalog==e&&l._globe.arrow._layer.subset[r].subcatalog==a){return l._globe.arrow._layer.subset[r].polygon}}for(var r=0;r<l._globe.doubleArrow._layer.length;r++){if(l._globe.doubleArrow._layer[r].catalog==layer&&l._globe.doubleArrow._layer[r].subcatalog==sublayer){return l._globe.doubleArrow._layer[r].polygon}}for(var r=0;r<l._globe.battleLine._layer.subset.length;r++){if(l._globe.battleLine._layer.subset[r].catalog==e&&l._globe.battleLine._layer.subset[r].subcatalog==a){return l._globe.battleLine._layer.subset[r].polygon}}for(var r=0;r<l._globe.isolationBelt._layer.subset.length;r++){if(l._globe.isolationBelt._layer.subset[r].catalog==e&&l._globe.isolationBelt._layer.subset[r].subcatalog==a){return l._globe.isolationBelt._layer.subset[r].polygon}}for(var r=0;r<l._globe.ellipse._layer.length;r++){if(l._globe.ellipse._layer[r].catalog==layer&&l._globe.ellipse._layer[r].subcatalog==sublayer){return l._globe.ellipse._layer[r].ellipse}}for(var r=0;r<l._globe.circle._layer.length;r++){if(l._globe.circle._layer[r].catalog==layer&&l._globe.circle._layer[r].subcatalog==sublayer){return l._globe.circle._layer[r].circle}}};e.prototype._setShowByCatalog=function(e,a,l){var r=this;if(!r._globe._showBottomInfo){return}for(var t=0;t<r._globe.placeMark._layer.length;t++){if(r._globe.placeMark._layer[t].catalog==e&&r._globe.placeMark._layer[t].subcatalog==a){r._globe.placeMark._layer[t].showLayer=l}}for(var t=0;t<r._globe.placeMark._layer_dataSource.length;t++){if(r._globe.placeMark._layer_dataSource[t].catalog==e&&r._globe.placeMark._layer_dataSource[t].subcatalog==a){r._globe.placeMark._layer_dataSource[t].showLayer=l}}for(var t=0;t<r._globe.model._layer.length;t++){if(r._globe.model._layer[t].catalog==e&&r._globe.model._layer[t].subcatalog==a){r._globe.model._layer[t].showLayer=l}}for(var t=0;t<r._globe.particle._layer.length;t++){if(r._globe.particle._layer[t].catalog==e&&r._globe.particle._layer[t].subcatalog==a){r._globe.particle._layer[t].showLayer=l}}for(var t=0;t<r._globe.point._layer.length;t++){if(r._globe.point._layer[t].catalog==e&&r._globe.point._layer[t].subcatalog==a){r._globe.point._layer[t].showLayer=l}}for(var t=0;t<r._globe.polyline._layer.length;t++){if(r._globe.polyline._layer[t].catalog==e&&r._globe.polyline._layer[t].subcatalog==a){r._globe.polyline._layer[t].showLayer=l}}for(var t=0;t<r._globe.polygon._layer.length;t++){if(r._globe.polygon._layer[t].catalog==e&&r._globe.polygon._layer[t].subcatalog==a){r._globe.polygon._layer[t].showLayer=l}}for(var t=0;t<r._globe.freeline._layer.length;t++){if(r._globe.freeline._layer[t].catalog==e&&r._globe.freeline._layer[t].subcatalog==a){r._globe.freeline._layer[t].showLayer=l}}for(var t=0;t<r._globe.arrow._layer.subset.length;t++){if(r._globe.arrow._layer.subset[t].catalog==e&&r._globe.arrow._layer.subset[t].subcatalog==a){r._globe.arrow._layer.subset[t].showLayer=l}}for(var t=0;t<r._globe.doubleArrow._layer.length;t++){if(r._globe.doubleArrow._layer[t].catalog==e&&r._globe.doubleArrow._layer[t].subcatalog==a){r._globe.doubleArrow._layer[t].showLayer=l}}for(var t=0;t<r._globe.battleLine._layer.subset.length;t++){if(r._globe.battleLine._layer.subset[t].catalog==e&&r._globe.battleLine._layer.subset[t].subcatalog==a){r._globe.battleLine._layer.subset[t].showLayer=l}}for(var t=0;t<r._globe.isolationBelt._layer.subset.length;t++){if(r._globe.isolationBelt._layer.subset[t].catalog==e&&r._globe.isolationBelt._layer.subset[t].subcatalog==a){r._globe.isolationBelt._layer.subset[t].showLayer=l}}for(var t=0;t<r._globe.ellipse._layer.length;t++){if(r._globe.ellipse._layer[t].catalog==e&&r._globe.ellipse._layer[t].subcatalog==a){r._globe.ellipse._layer[t].showLayer=l}}for(var t=0;t<r._globe.circle._layer.length;t++){if(r._globe.circle._layer[t].catalog==e&&r._globe.circle._layer[t].subcatalog==a){r._globe.circle._layer[t].showLayer=l}}for(var t=0;t<r._globe.rectangle._layer.length;t++){if(r._globe.rectangle._layer[t].catalog==e&&r._globe.rectangle._layer[t].subcatalog==a){r._globe.rectangle._layer[t].showLayer=l}}};e.prototype._remove=function(e,a,l){var r=this;if(!r._globe._showBottomInfo){return}if(e=="globeLayer"){for(var t=0;t<r._layerManager[2].subset.length;t++){if(r._layerManager[2].subset[t].layer==a){r._layerManager[2].subset.splice(t,1)}}var o=document.getElementById("cfglobe_layer_checkbox_"+e+"splitLayer"+a);o.parentNode.parentNode.removeChild(o.parentNode)}else if(e=="vectorLayer"){for(var t=0;t<r._layerManager[3].subset.length;t++){if(r._layerManager[3].subset[t].layer==a){r._layerManager[3].subset.splice(t,1)}}var o=document.getElementById("cfglobe_layer_checkbox_"+e+"splitLayer"+a);o.parentNode.parentNode.removeChild(o.parentNode)}else if(e=="shpLayer"){for(var t=0;t<r._layerManager[1].subset.length;t++){if(r._layerManager[1].subset[t].layer==a){r._layerManager[1].subset.splice(t,1)}}var o=document.getElementById("cfglobe_layer_checkbox_"+e+"splitLayer"+a);o.parentNode.parentNode.removeChild(o.parentNode)}else if(e=="entityLayer"){var _=true;for(var t=0;t<r._globe.placeMark._layer.length;t++){if(r._globe.placeMark._layer[t].catalog==a&&r._globe.placeMark._layer[t].subcatalog==l){_=false;break}}for(var t=0;t<r._globe.placeMark._layer_dataSource.length;t++){if(r._globe.placeMark._layer_dataSource[t].catalog==a&&r._globe.placeMark._layer_dataSource[t].subcatalog==l){_=false;break}}for(var t=0;t<r._globe.model._layer.length;t++){if(r._globe.model._layer[t].catalog==a&&r._globe.model._layer[t].subcatalog==l){_=false;break}}for(var t=0;t<r._globe.particle._layer.length;t++){if(r._globe.particle._layer[t].catalog==a&&r._globe.particle._layer[t].subcatalog==l){_=false;break}}for(var t=0;t<r._globe.point._layer.length;t++){if(r._globe.point._layer[t].catalog==a&&r._globe.point._layer[t].subcatalog==l){_=false;break}}for(var t=0;t<r._globe.polyline._layer.length;t++){if(r._globe.polyline._layer[t].catalog==a&&r._globe.polyline._layer[t].subcatalog==l){_=false;break}}for(var t=0;t<r._globe.polygon._layer.length;t++){if(r._globe.polygon._layer[t].catalog==a&&r._globe.polygon._layer[t].subcatalog==l){_=false;break}}for(var t=0;t<r._globe.freeline._layer.length;t++){if(r._globe.freeline._layer[t].catalog==a&&r._globe.freeline._layer[t].subcatalog==l){_=false;break}}for(var t=0;t<r._globe.arrow._layer.subset.length;t++){if(r._globe.arrow._layer.subset[t].catalog==a&&r._globe.arrow._layer.subset[t].subcatalog==l){_=false;break}}for(var t=0;t<r._globe.doubleArrow._layer.length;t++){if(r._globe.doubleArrow._layer[t].catalog==a&&r._globe.doubleArrow._layer[t].subcatalog==l){_=false;break}}for(var t=0;t<r._globe.battleLine._layer.subset.length;t++){if(r._globe.battleLine._layer.subset[t].catalog==a&&r._globe.battleLine._layer.subset[t].subcatalog==l){_=false;break}}for(var t=0;t<r._globe.isolationBelt._layer.subset.length;t++){if(r._globe.isolationBelt._layer.subset[t].catalog==a&&r._globe.isolationBelt._layer.subset[t].subcatalog==l){_=false;break}}for(var t=0;t<r._globe.ellipse._layer.length;t++){if(r._globe.ellipse._layer[t].catalog==a&&r._globe.ellipse._layer[t].subcatalog==l){_=false;break}}for(var t=0;t<r._globe.circle._layer.length;t++){if(r._globe.circle._layer[t].catalog==a&&r._globe.circle._layer[t].subcatalog==l){_=false;break}}if(_){var o;var g=true;for(var t=0;t<r._layerManager[0].subset.length;t++){var n=r._layerManager[0].subset[t];if(n.title==a&&n.subtitle==l){o=document.getElementById("cfglobe_layer_checkbox_"+e+"splitSubLayer"+n.layer);r._layerManager[0].subset.splice(t,1);break}}for(var t=0;t<r._layerManager[0].subset.length;t++){var n=r._layerManager[0].subset[t];if(n.title==a){g=false;break}}if(g){o.parentNode.parentNode.parentNode.removeChild(o.parentNode.parentNode)}else{o.parentNode.parentNode.removeChild(o.parentNode)}}}};return e});