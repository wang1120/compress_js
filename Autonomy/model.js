define([],function(){function e(e){var l=this;this._globe=e;this._viewer=e._viewer;this._globeId=e._globeId;this._minHeight=0;this._maxHeight=1e6;this._catalog="default";this._subcatalog="default";this._layer=[];this._options={draw:false,minHeight:0,maxHeight:1e6,catalog:"default",subcatalog:"default",handlerCallback:null,options:null};this._viewer.scene.postRender.addEventListener(function(){var e=0;var a=l._viewer.scene.mode;if(a==Cesium.SceneMode.SCENE3D){var r=Cesium.Cartographic.fromCartesian(l._viewer.scene.camera.position);e=r.height}else{e=Math.ceil(l._viewer.camera.positionCartographic.height)}for(var t=0;t<l._layer.length;t++){if(e>=l._layer[t].minHeight&&e<=l._layer[t].maxHeight){l._layer[t].showHeight=true}else{l._layer[t].showHeight=false}if(l._layer[t].showHeight&&l._layer[t].showLayer&&l._layer[t].showEntity){l._layer[t].show=true}else{l._layer[t].show=false}}});this._handler=new Cesium.ScreenSpaceEventHandler(this._viewer.scene.canvas);this._handler.setInputAction(function(e){var a=l._globe.getLonLatByPosition(e.position);if(l._options.draw){var r={};for(var t in l._options.options){if(t!="layer"){r[t]=typeof l._options.options[t]==="object"?deepCoyp(l._options.options[t]):l._options.options[t]}}r.lon=a.lon;r.lat=a.lat;r.alt=a.alt;r.layer=l._options.options.layer?l._options.options.layer:null;var i=l.add(r);if(l._options.handlerCallback){l._options.handlerCallback(i)}}},Cesium.ScreenSpaceEventType.LEFT_CLICK)}e.prototype.add=function(e){var a=this;var r=new Cesium.PinBuilder;var t=e.mid?e.mid:"";var i=e.name?e.name:"default";var l=e.scale?parseFloat(e.scale):1;var o=e.lon?parseFloat(e.lon):0;var n=e.lat?parseFloat(e.lat):0;var s=e.alt?parseFloat(e.alt):0;var h=e.uri?e.uri:"";var _=e.callback?e.callback:null;var v=e.setMenu?e.setMenu:null;var c=e.leftClick?e.leftClick:null;var g=e.rightClick?e.rightClick:null;var u=e.description?e.description:"";var y=e.showBox!==false;var p=e.windowWidth?parseInt(e.windowWidth):100;var d=e.windowHeight?parseInt(e.windowHeight):80;var f=e.src?e.src:"";var m=e.showWindow!==false;var w=e.catalog?e.catalog:a._catalog;var C=e.subcatalog?e.subcatalog:a._subcatalog;var b=e.minHeight?e.minHeight:a._minHeight;var H=e.maxHeight?e.maxHeight:a._maxHeight;var E=e.label?e.label:"";var L=e.heightReference?e.heightReference:Cesium.HeightReference.RELATIVE_TO_GROUND;var k;if(e.heightReference){k=Cesium.Cartesian3.fromDegrees(o,n,s)}else{k=Cesium.Cartesian3.fromDegrees(o,n)}var I={lon:o,lat:n,alt:s};var M=a._viewer.entities.add({mid:t,name:i,catalog:w,subcatalog:C,minHeight:b,maxHeight:H,showHeight:true,showLayer:true,showEntity:true,showBox:y,showWindow:m,windowWidth:p,windowHeight:d,src:f,callback:_,setMenu:v,leftClick:c,rightClick:g,position:k,description:u,modelPoint:I,options:e,model:{uri:h,scale:l,heightReference:Cesium.HeightReference.RELATIVE_TO_GROUND,shadows:Cesium.ShadowMode.ENABLED},label:{text:E,font:"14pt sans-serif",horizontalOrigin:Cesium.HorizontalOrigin.LEFT,verticalOrigin:Cesium.VerticalOrigin.BASELINE,heightReference:L,disableDepthTestDistance:Number.POSITIVE_INFINITY}});a._layer[a._layer.length]=M;var x=(new Date).getTime()+"a"+parseInt(100*Math.random());a._globe.layerManager._add("entityLayer",x,w,C);return M};e.prototype.revise=function(e,a){var r=this;for(var t=r._layer.length-1;t>=0;t--){if(r._layer[t]==e){var i=Cesium.Cartographic.fromCartesian(r._layer[t]._position._value);var l=Cesium.Math.toDegrees(i.longitude);var o=Cesium.Math.toDegrees(i.latitude);var n=i.height;var s=a.lon?parseFloat(a.lon):l;var h=a.lat?parseFloat(a.lat):o;var _=a.alt?parseFloat(a.alt):n;var v=a.scale?parseFloat(a.scale):r._layer[t]._model._scale._value;var c=a.label?a.label:r._layer[t]._label._text._value;var g=r._layer[t].showEntity;if(!!a.show===a.show){g=a.show}r._layer[t]._position._value=Cesium.Cartesian3.fromDegrees(s,h,_);r._layer[t]._label._text._value=c;r._layer[t]._model._scale._value=v;r._layer[t].showEntity=g}}};e.prototype.drawHandler=function(e){var a=this;a._options.draw=true;a._options.options=e;var r=e.handlerCallback?e.handlerCallback:null;a._options.handlerCallback=r};e.prototype.deactivateHandler=function(){var e=this;e._options.draw=false};e.prototype.remove=function(e){var a=this;for(var r=a._layer.length-1;r>=0;r--){if(a._layer[r]==e){var t=a._layer[r].catalog;var i=a._layer[r].subcatalog;var l=a._viewer.entities.remove(e);a._layer.splice(r,1);a._globe.layerManager._remove("entityLayer",t,i);return l}}};e.prototype.removeByMid=function(e){var a=this;var r=true;for(var t=a._layer.length-1;t>=0;t--){if(a._layer[t].mid==e){var i=a._layer[t].catalog;var l=a._layer[t].subcatalog;r=a._viewer.entities.remove(a._layer[t]);a._layer.splice(t,1);a._globe.layerManager._remove("entityLayer",i,l);if(!r){return r}}}return r};e.prototype.removeByName=function(e){var a=this;var r=true;for(var t=a._layer.length-1;t>=0;t--){if(a._layer[t].name==e){var i=a._layer[t].catalog;var l=a._layer[t].subcatalog;r=a._viewer.entities.remove(a._layer[t]);a._layer.splice(t,1);a._globe.layerManager._remove("entityLayer",i,l);if(!r){return r}}}return r};e.prototype.getByMid=function(e){var a=this;var r=[];for(var t=a._layer.length-1;t>=0;t--){if(a._layer[t].mid==e){r[r.length]=a._layer[t]}}return r};e.prototype.getByName=function(e){var a=this;var r=[];for(var t=a._layer.length-1;t>=0;t--){if(a._layer[t].name==e){r[r.length]=a._layer[t]}}return r};return e});