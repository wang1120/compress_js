define([],function(){function e(e){var i=this;this._nunid=0;this._globe=e;this._viewer=e._viewer;this._globeId=e._globeId;this._infoWindowList=[];this._loadInfoWindow();this._viewer.scene.postRender.addEventListener(function(){i._positionPopUp()});this._handler=new Cesium.ScreenSpaceEventHandler(this._viewer.scene.canvas);this._handler.setInputAction(function(e){var t=i._viewer.scene.pick(e.position);if(Cesium.defined(t)){if(t.id){if(t.id._callback){t.id._callback(t.id)}}}},Cesium.ScreenSpaceEventType.LEFT_CLICK)}e.prototype._loadInfoWindow=function(){var e=this;var t=document.createElement("div");t.setAttribute("id","cfglobe_infoWindow");document.getElementById(e._globeId).getElementsByTagName("div")[0].appendChild(t)};e.prototype.build=function(e){var t=this;var i=e.width?parseInt(e.width):100;var n=e.height?parseInt(e.height):80;var o=e.top?parseInt(e.top):0;var r=e.left?parseInt(e.left):0;var d=e.src?e.src:"";var a=e.des?e.des:"";var l=e.title?e.title:"";var s=e.showClose!==false;var c=e.callback?e.callback:null;var f=e.beforeClose?e.beforeClose:null;var p=e.afterClose?e.afterClose:null;var u=e.lonlat?e.lonlat:null;var v=e.id?e.id:t._nunid;var w=e.background?e.background:null;if(!u){alert("位置信息不能为空！");return}var b=document.createElement("div");b.setAttribute("id","cfglobe_infowindow_"+v);var _=document.createElement("div");_.setAttribute("id","cfglobe_infowindow_content_"+v);_.setAttribute("class","cfglobe-infowindow");_.setAttribute("style","top:-"+o+"px;left:-"+r+"px;");b.appendChild(_);if(s){var h=document.createElement("a");h.setAttribute("class","cfglobe-infowindow-close-button");h.setAttribute("id","cfglobe_infowindow_a_"+v);h.innerHTML="×";h.onclick=function(){t._remove(this)};_.appendChild(h)}var m=document.createElement("div");m.setAttribute("class","cfglobe-infowindow-content-wrapper");if(w){m.setAttribute("style","background:"+w)}_.appendChild(m);var g=document.createElement("div");g.setAttribute("class","cfglobe-infowindow-content");m.appendChild(g);var C=document.createElement("div");C.setAttribute("class","cfglobe-infowindow-title");C.innerHTML=l;g.appendChild(C);var A=document.createElement("div");A.setAttribute("id","cfglobe_infowindow_des_"+v);A.setAttribute("class","cfglobe-infowindow-des");A.setAttribute("style","width:"+i+"px;height:"+n+"px;");if(a){A.innerHTML=a}g.appendChild(A);if(d!=""){var L=document.createElement("iframe");L.setAttribute("width","100%");L.setAttribute("height","100%");L.setAttribute("style","border:0;");L.setAttribute("src",d);A.appendChild(L)}var W=document.createElement("div");W.setAttribute("class","cfglobe-infowindow-bot");g.appendChild(W);var E=document.createElement("div");E.setAttribute("class","cfglobe-infowindow-tip-container");_.appendChild(E);var y=document.createElement("div");y.setAttribute("class","cfglobe-infowindow-tip");E.appendChild(y);document.getElementById("cfglobe_infoWindow").appendChild(b);e.id=v;var I=t._viewer.scene.globe.ellipsoid;var k=Cesium.Cartographic.fromDegrees(u.lon,u.lat,u.alt);var x=I.cartographicToCartesian(k);e.position=x;e.beforeClose=f;e.afterClose=p;e.callback=c;t._infoWindowList[t._infoWindowList.length]=e;t._nunid++;t._positionPopUp();return e.id};e.prototype.build2=function(e){var t=this;var i=e.width?parseInt(e.width):100;var n=e.height?parseInt(e.height):80;var o=e.top?parseInt(e.top):0;var r=e.left?parseInt(e.left):0;var d=e.src?e.src:"";var a=e.des?e.des:"";var l=e.title?e.title:"";var s=e.showClose!==false;var c=e.callback?e.callback:null;var f=e.beforeClose?e.beforeClose:null;var p=e.afterClose?e.afterClose:null;var u=e.lonlat?e.lonlat:null;var v=e.id?e.id:t._nunid;var w=e.background?e.background:null;if(!u){alert("位置信息不能为空！");return}var b=document.createElement("div");b.setAttribute("id","cfglobe_infowindow_"+v);var _=document.createElement("div");_.setAttribute("id","cfglobe_infowindow_content_"+v);_.setAttribute("class","cfglobe-infowindow");_.setAttribute("style","top:-"+o+"px;left:-"+r+"px;");b.appendChild(_);if(s){var h=document.createElement("a");h.setAttribute("class","cfglobe-infowindow-close-button");h.setAttribute("id","cfglobe_infowindow_a_"+v);h.innerHTML="×";h.onclick=function(){t._remove(this)};_.appendChild(h)}var m=document.createElement("div");m.setAttribute("class","cfglobe-infowindow-content-wrapper");if(w){m.setAttribute("style","background:"+w+";width:"+i+"px;height:"+n+"px")}_.appendChild(m);var g=document.createElement("div");g.setAttribute("class","cfglobe-infowindow-content");m.appendChild(g);var C=document.createElement("div");C.setAttribute("class","cfglobe-infowindow-title");C.innerHTML=l;g.appendChild(C);var A=document.createElement("div");A.setAttribute("id","cfglobe_infowindow_des_"+v);A.setAttribute("class","cfglobe-infowindow-des");A.setAttribute("style","width:"+i+"px;height:"+n+"px;");if(a){A.innerHTML=a}g.appendChild(A);if(d!=""){var L=document.createElement("iframe");L.setAttribute("width","100%");L.setAttribute("height","100%");L.setAttribute("style","border:0;");L.setAttribute("src",d);A.appendChild(L)}var W=document.createElement("div");W.setAttribute("class","cfglobe-infowindow-bot");g.appendChild(W);var E=document.createElement("div");E.setAttribute("class","cfglobe-infowindow-tip-container");_.appendChild(E);var y=document.createElement("div");y.setAttribute("class","cfglobe-infowindow-tip");E.appendChild(y);document.getElementById("cfglobe_infoWindow").appendChild(b);e.id=v;var I=t._viewer.scene.globe.ellipsoid;var k=Cesium.Cartographic.fromDegrees(u.lon,u.lat,u.alt);var x=I.cartographicToCartesian(k);e.position=x;e.beforeClose=f;e.afterClose=p;e.callback=c;t._infoWindowList[t._infoWindowList.length]=e;t._nunid++;t._positionPopUp();return e.id};e.prototype.reviseById=function(e,t,i,n){var o=this;for(var r=o._infoWindowList.length-1;r>=0;r--){if(o._infoWindowList[r].id==e){var d=document.getElementById("cfglobe_infowindow_des_"+e);if(i){d.style.width=i+"px"}if(n){d.style.height=n+"px"}var a=o._viewer.scene.globe.ellipsoid;var l=Cesium.Cartographic.fromDegrees(t.lon,t.lat,t.alt);var s=a.cartographicToCartesian(l);o._infoWindowList[r].position=s;o._positionPopUp()}}};e.prototype._remove=function(e){var t=this;var i=e.id.replace("cfglobe_infowindow_a_","");t.removeById(i)};e.prototype.removeById=function(e){var t=this;var i=-1;for(var n=t._infoWindowList.length-1;n>=0;n--){if(t._infoWindowList[n].id==e){i=n;break}}if(i>=0){if(t._infoWindowList[i].beforeClose){t._infoWindowList[i].beforeClose()}var o=document.getElementById("cfglobe_infowindow_"+e);if(o){document.getElementById("cfglobe_infoWindow").removeChild(o)}if(t._infoWindowList[i].afterClose){t._infoWindowList[i].afterClose()}if(t._infoWindowList[i].callback){t._infoWindowList[i].callback()}t._infoWindowList.splice(i,1)}};e.prototype.removeAll=function(){var e=this;for(var t=e._infoWindowList.length-1;t>=0;t--){if(e._infoWindowList[t].beforeClose){e._infoWindowList[t].beforeClose()}var i=document.getElementById("cfglobe_infowindow_"+e._infoWindowList[t].id);if(i){document.getElementById("cfglobe_infoWindow").removeChild(i)}if(e._infoWindowList[t].afterClose){e._infoWindowList[t].afterClose()}if(e._infoWindowList[t].callback){e._infoWindowList[t].callback()}e._infoWindowList.splice(t,1)}};e.prototype._positionPopUp=function(){var e=this;for(var t=0;t<e._infoWindowList.length;t++){var i=Cesium.SceneTransforms.wgs84ToWindowCoordinates(e._viewer.scene,e._infoWindowList[t].position);if(i){var n=document.getElementById("cfglobe_infowindow_content_"+e._infoWindowList[t].id);if(n){var o=i.x-n.offsetWidth/2;var r=i.y-n.offsetHeight;n.style.transform="translate3d("+Math.round(o)+"px, "+Math.round(r)+"px, 0)"}}}};return e});