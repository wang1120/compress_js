define([],function(){CommonFunc={getDistanceAndAngle:function(t,a){var n=t.lon;var r=t.lat;var i=t.alt;var e=a.lon;var l=a.lat;var h=a.alt;var s=i-h;s=Math.abs(s);var o=this.getDistance(n,r,e,l);var v=this.getAngle(n,r,e,l);var M=Math.atan(s/o);M=this.deg(M);if(i>h){M=-M}var c={distance:o,angle:v,pitch:M};return c},getArrowPointList:function(t,a,n){if(t.length<2){return[]}var r=2e3;var i=6;var e=0;var l=0;for(var h=1;h<t.length;h++){e=this.getDistance(t[h-1].lon,t[h-1].lat,t[h].lon,t[h].lat);l+=e}var s=l/i;var o=[];var v=[];for(var h=1;h<t.length;h++){var M,c;var g=t[h-1];var f=t[h];if(h==1){var u=this.getAngle(g.lon,g.lat,f.lon,f.lat);if(n=="basic"||n=="diagonal"){M=this.destinationVincenty(g.lon,g.lat,r,u-90,0,s/2);c=this.destinationVincenty(g.lon,g.lat,r,u+90,0,s/2)}else if(n=="doubleTail"){M=this.destinationVincenty(g.lon,g.lat,r,u-135,0,s*.8);c=this.destinationVincenty(g.lon,g.lat,r,u+135,0,s*.8)}o[o.length]=M;v[v.length]=c}else{var d=t[h-2];var y=this.getDistance(d.lon,d.lat,g.lon,g.lat);var I=this.getDistance(g.lon,g.lat,f.lon,f.lat);var P=this.getAngle(d.lon,d.lat,g.lon,g.lat);var V=this.getAngle(g.lon,g.lat,f.lon,f.lat);var b=90-(V-P+180)/2+V;if(Math.abs(P-V)<1||s>e){M=this.destinationVincenty(g.lon,g.lat,r,b-90,0,s/2);o[o.length]=M;c=this.destinationVincenty(g.lon,g.lat,r,b+90,0,s/2);v[v.length]=c}else{if(0<P&&P<90){if(270<V&&V<360){b=V-270-(V-P-180)/2}}else if(90<P&&P<180){if(270<V&&V<360){b=V-270-(V-P-180)/2}}else if(180<P&&P<270){if(0<V&&V<90){b=270+V+(P-V-180)/2}}else if(270<P&&P<360){if(0<V&&V<90){b=270+V+(P-V-180)/2}}var _=this.destinationVincenty(d.lon,d.lat,r,P-90,0,s/2);var A=this.destinationVincenty(g.lon,g.lat,r,b-90,0,s/2);var C=this.destinationVincenty(A.lon,A.lat,r,V,0,I);if(h==t.length-1){var m=this.getAngle(f.lon,f.lat,g.lon,g.lat);var p=s;if(s>e){p=e}var q=this.destinationVincenty(f.lon,f.lat,r,m,0,p);if(n!="diagonal"){C=this.destinationVincenty(q.lon,q.lat,r,V-90,0,s/2)}else{C=this.destinationVincenty(q.lon,q.lat,r,V-90,0,s/8)}}var z=[_,A,C];var L=this.getBezier(z);for(var T=0;T<L.length-1;T++){o[o.length]=L[T]}var x=this.destinationVincenty(d.lon,d.lat,r,P+90,0,s/2);var B=this.destinationVincenty(g.lon,g.lat,r,b+90,0,s/2);var D=this.destinationVincenty(B.lon,B.lat,r,V,0,I);if(h==t.length-1){var j=this.getAngle(f.lon,f.lat,g.lon,g.lat);var G=s;if(s>e){G=e}var w=this.destinationVincenty(f.lon,f.lat,r,j,0,G);if(n!="diagonal"){D=this.destinationVincenty(w.lon,w.lat,r,V+90,0,s/2)}else{D=this.destinationVincenty(w.lon,w.lat,r,V+90,0,s/8)}}var X=[x,B,D];var Y=this.getBezier(X);for(var T=0;T<Y.length-1;T++){v[v.length]=Y[T]}}}if(h==t.length-1){var V=this.getAngle(g.lon,g.lat,f.lon,f.lat);var j=this.getAngle(f.lon,f.lat,g.lon,g.lat);var G=s;if(s>e){G=e}var w=this.destinationVincenty(f.lon,f.lat,r,j,0,G);var O=this.destinationVincenty(w.lon,w.lat,r,V-90,0,s/2);var F=this.destinationVincenty(w.lon,w.lat,r,V-90,0,s);var k=this.destinationVincenty(w.lon,w.lat,r,V+90,0,s/2);var E=this.destinationVincenty(w.lon,w.lat,r,V+90,0,s);if(n=="diagonal"){O=this.destinationVincenty(w.lon,w.lat,r,V-90,0,s/8);F=this.destinationVincenty(w.lon,w.lat,r,V-90,0,s/4);k=this.destinationVincenty(w.lon,w.lat,r,V+90,0,s/8);E=this.destinationVincenty(w.lon,w.lat,r,V+90,0,s/4)}o[o.length]=O;o[o.length]=F;v[v.length]=k;v[v.length]=E}}var H=[];for(var h=0;h<o.length;h++){H[H.length]=o[h]}H[H.length]={lon:t[t.length-1].lon,lat:t[t.length-1].lat,alt:r};for(var h=v.length-1;h>=0;h--){H[H.length]=v[h]}if(n=="doubleTail"||n=="diagonal"){H[H.length]={lon:t[0].lon,lat:t[0].lat,alt:r}}if(a=="polyline"){H[H.length]=o[0]}var J=new Array;for(var h=0;h<H.length;h++){J.push(H[h].lon);J.push(H[h].lat);J.push(H[h].alt)}return J},getBezier:function(t){var a=[];var n=2e3;var r=t[0];var i=t[1];var e=t[2];var l=this.getAngle(r.lon,r.lat,i.lon,i.lat);var h=this.getAngle(i.lon,i.lat,e.lon,e.lat);var s=this.getAngle(r.lon,r.lat,e.lon,e.lat);var o=this.getDistance(r.lon,r.lat,i.lon,i.lat);var v=this.getDistance(i.lon,i.lat,e.lon,e.lat);var M=50;var c=s-l;var g=new Cesium.PinBuilder;for(var f=2;f<M;f++){var u=this.destinationVincenty(r.lon,r.lat,n,l,0,o*(f-1)/M);var d=this.destinationVincenty(r.lon,r.lat,n,l,0,o*f/M);var y=this.destinationVincenty(i.lon,i.lat,n,h,0,v*(f-1)/M);var I=this.destinationVincenty(i.lon,i.lat,n,h,0,v*f/M);var P=u.lon;var V=u.lat;var b=y.lon;var _=y.lat;var A=d.lon;var C=d.lat;var m=I.lon;var p=I.lat;var q=(V-_)/(P-b);var z=(C-p)/(A-m);var L=(q*P-z*A+C-V)/(q-z);var T=V+(L-P)*q;a[a.length]={lon:L,lat:T,alt:n}}a[a.length]=e;return a},getDistance:function(t,a,n,r){var i=a*Math.PI/180;var e=r*Math.PI/180;var l=i-e;var h=t*Math.PI/180-n*Math.PI/180;var s=2*Math.asin(Math.sqrt(Math.pow(Math.sin(l/2),2)+Math.cos(i)*Math.cos(e)*Math.pow(Math.sin(h/2),2)));s=s*6378.137;s=Math.round(s*1e4)/1e4;return s*1e3},getDistanceByline:function(t,a,n,r){var i=this.rad((a+r)/2);var e=this.rad((a-r)/2);var l=this.rad((t-n)/2);var h=Math.sin(e);var s=Math.sin(l);var o=Math.sin(i);var v,M,c,g,f,u,d;var y=6378137;var I=1/298.257;h=h*h;s=s*s;o=o*o;v=h*(1-s)+(1-o)*s;M=(1-h)*(1-s)+o*s;c=Math.atan(Math.sqrt(v/M));g=Math.sqrt(v*M)/c;f=2*c*y;u=(3*g-1)/2/M;d=(3*g+1)/2/v;v=f*(1+I*(u*o*(1-h)-d*(1-o)*h));return v},getCartesian:function(t,a){var n=6378137;var r=Math.cos(this.rad(a))*Math.cos(this.rad(t))*n;var i=Math.sin(this.rad(t))*Math.cos(this.rad(a))*n;var e=Math.sin(this.rad(a))*n;return{x:r,y:i,z:e}},getCircle:function(t,a,n){var r=(a.y-t.y)*(n.z-t.z)-(n.y-t.y)*(a.z-t.z);var i=(a.z-t.z)*(n.x-t.x)-(n.z-t.z)*(a.x-t.x);var e=(a.x-t.x)*(n.y-t.y)-(n.x-t.x)*(a.y-t.y);return{a:r,b:i,c:e}},getAngleByCircle:function(t,a,n,r){var i=0;if(a-r==0){i=90}else{var e=this.getCartesian(t,a);var l=this.getCartesian(n,r);var h=(n-t)/2;var s=(r-a)/2;var o=this.getCartesian(t+h,a+s);var v=e;var M=this.getCartesian(0,90);var c=this.getCartesian(0,0);var g=this.getCircle(e,l,o);var f=this.getCircle(v,M,c);var u=(g.a*f.a+g.b*f.b+g.c*f.c)/(Math.sqrt(g.a*g.a+g.b*g.b+g.c*g.c)*Math.sqrt(f.a*f.a+f.b*f.b+f.c*f.c));i=this.deg(Math.acos(u))}if(a>r){i=i+180}if(i<0){i=360+i}return i},getAngle:function(t,a,n,r){var i=0;var e=(a+r)/2;if(a-r==0){i=90}else{i=Math.atan((t-n)*Math.cos(this.rad(e))/(a-r))*180/Math.PI}if(a>r){i=i+180}if(i<0){i=360+i}return i},getAngleByMercator:function(t,a,n,r){var i=this.lonLat2Mercator(t,a);var e=this.lonLat2Mercator(n,r);var l=this.lonLat2Mercator(t,a+1);var h=0,s=0,o=0;var v=l.X-i.X;var M=l.Y-i.Y;var c=e.X-i.X;var g=e.Y-i.Y;h=v*c+M*g;o=(v*v+M*M)*(c*c+g*g);h/=Math.sqrt(o);if(h>=1)return 0;if(h<=-1)return Math.PI;s=Math.acos(h);if(180*s/Math.PI<180){return 180*s/Math.PI}else{return 360-180*s/Math.PI}},destinationVincenty:function(t,a,n,r,i,e){var l=6378137,h=6356752.3142,s=1/298.257223563;var o=t;var v=a;var M=e;var c=this.rad(r);var g=Math.sin(c);var f=Math.cos(c);var u=(1-s)*Math.tan(this.rad(v));var d=1/Math.sqrt(1+u*u),y=u*d;var I=Math.atan2(u,f);var P=d*g;var V=1-P*P;var b=V*(l*l-h*h)/(h*h);var _=1+b/16384*(4096+b*(-768+b*(320-175*b)));var A=b/1024*(256+b*(-128+b*(74-47*b)));var C=M/(h*_),m=2*Math.PI;while(Math.abs(C-m)>1e-12){var p=Math.cos(2*I+C);var q=Math.sin(C);var z=Math.cos(C);var L=A*q*(p+A/4*(z*(-1+2*p*p)-A/6*p*(-3+4*q*q)*(-3+4*p*p)));m=C;C=M/(h*_)+L}var T=y*q-d*z*f;var x=Math.atan2(y*z+d*q*f,(1-s)*Math.sqrt(P*P+T*T));var B=Math.atan2(q*g,d*z-y*q*f);var D=s/16*V*(4+s*(4-3*V));var j=B-(1-D)*s*P*(C+D*q*(p+D*z*(-1+2*p*p)));var G=Math.atan2(P,-T);var w=e*180/(Math.PI*l);var X=90-w-i;var Y=(n+l)*Math.sin(this.rad(i+90))/Math.sin(this.rad(X));var O=Y-l;var F={lon:o+this.deg(j),lat:this.deg(x),alt:O};return F},rad:function(t){return t*Math.PI/180},deg:function(t){return t*180/Math.PI},formatDegree:function(t){var a="";if(t<0){a="-"}t=Math.abs(t);var n=Math.floor(t);var r=Math.floor((t-n)*60);var i=r;if(r<10){i="0"+r}var e=((t-n)*60-r)*60;var l=e;if(e<10){l="0"+e}var h=a+n+"Â°"+i+"'"+l+'"';var s={d:parseInt(a+n),f:parseInt(r),m:e,value:h};return s},degreeConvertBack:function(t){var a=t.d;var n=t.f;var r=t.m;var i=Math.abs(a)+(Math.abs(n)/60+Math.abs(r)/3600);if(a<0){i=-(Math.abs(a)+(Math.abs(n)/60+Math.abs(r)/3600))}return i},lonLat2Mercator:function(t,a){var n=t*20037508.34/180;var r=Math.log(Math.tan((90+a)*Math.PI/360))/(Math.PI/180);r=r*20037508.34/180;return{X:n,Y:r}},Mercator2lonLat:function(t){var a=t.x/20037508.34*180;var n=t.y/20037508.34*180;n=180/Math.PI*(2*Math.atan(Math.exp(n*Math.PI/180))-Math.PI/2);return{lon:a,lat:n}},outOfChina:function(t,a){if(t<72.004||t>137.8347)return true;if(a<.8293||a>55.8271)return true;return false},transformLat:function(t,a){var n=-100+2*t+3*a+.2*a*a+.1*t*a+.2*Math.sqrt(Math.abs(t));n+=(20*Math.sin(6*t*Math.PI)+20*Math.sin(2*t*Math.PI))*2/3;n+=(20*Math.sin(a*Math.PI)+40*Math.sin(a/3*Math.PI))*2/3;n+=(160*Math.sin(a/12*Math.PI)+320*Math.sin(a*Math.PI/30))*2/3;return n},transformLon:function(t,a){var n=300+t+2*a+.1*t*t+.1*t*a+.1*Math.sqrt(Math.abs(t));n+=(20*Math.sin(6*t*Math.PI)+20*Math.sin(2*t*Math.PI))*2/3;n+=(20*Math.sin(t*Math.PI)+40*Math.sin(t/3*Math.PI))*2/3;n+=(150*Math.sin(t/12*Math.PI)+300*Math.sin(t/30*Math.PI))*2/3;return n},transform:function(t,a){if(this.outOfChina(t,a)){return{lon:t,lat:a}}var n=6378245;var r=.006693421622965943;var i=this.transformLat(t-105,a-35);var e=this.transformLon(t-105,a-35);var l=a/180*Math.PI;var h=Math.sin(l);h=1-r*h*h;var s=Math.sqrt(h);i=i*180/(n*(1-r)/(h*s)*Math.PI);e=e*180/(n/s*Math.cos(l)*Math.PI);var o=a+i;var v=t+e;return{lon:v,lat:o}},gps84_To_Gcj02:function(t,a){if(this.outOfChina(t,a)){return null}var n=6378245;var r=.006693421622965943;var i=this.transformLat(t-105,a-35);var e=this.transformLon(t-105,a-35);var l=a/180*Math.PI;var h=Math.sin(l);h=1-r*h*h;var s=Math.sqrt(h);i=i*180/(n*(1-r)/(h*s)*Math.PI);e=e*180/(n/s*Math.cos(l)*Math.PI);var o=a+i;var v=t+e;return{lon:v,lat:o}},gcj02_To_Gps84:function(t,a){var n=this.transform(t,a);var r=t*2-n.lon;var i=a*2-n.lat;return{lon:r,lat:i}},gcj02_To_Bd09:function(t,a){var n=t,r=a;var i=Math.sqrt(n*n+r*r)+2e-5*Math.sin(r*Math.PI);var e=Math.atan2(r,n)+3e-6*Math.cos(n*Math.PI);var l=i*Math.cos(e)+.0065;var h=i*Math.sin(e)+.006;return{lon:l,lat:h}},bd09_To_Gcj02:function(t,a){var n=t-.0065,r=a-.006;var i=Math.sqrt(n*n+r*r)-2e-5*Math.sin(r*Math.PI);var e=Math.atan2(r,n)-3e-6*Math.cos(n*Math.PI);var l=i*Math.cos(e);var h=i*Math.sin(e);return{lon:l,lat:h}},gps84_To_Bd09:function(t,a){var n=this.gps84_To_Gcj02(t,a);var r=this.gcj02_To_Bd09(n.lon,n.lat);return r},bd09_To_Gps84:function(t,a){var n=this.bd09_To_Gcj02(t,a);var r=this.gcj02_To_Gps84(n.lon,n.lat);return r}};return CommonFunc});