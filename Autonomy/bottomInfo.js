define(["./commonFunc"],function(r){function e(e){var i=this;this._globe=e;this._viewer=e._viewer;this._ellipsoid=this._viewer.scene.globe.ellipsoid;this._globeId=e._globeId;if(!this._globe._showBottomInfo){return}this._lonlat;this._showDFM=true;this._bottom_info;this._loadBottomInfo();this._geodesic=new Cesium.EllipsoidGeodesic;this._distances=[1,2,3,5,10,20,30,50,100,200,300,500,1e3,2e3,3e3,5e3,1e4,2e4,3e4,5e4,1e5,2e5,3e5,5e5,1e6,2e6,3e6,5e6,1e7,2e7,3e7,5e7];this._handler=new Cesium.ScreenSpaceEventHandler(this._viewer.scene.canvas);this._handler.setInputAction(function(e){var t=i._viewer.scene.mode;var o=i._globe.getLonLatByPosition(e.endPosition);if(o){if(t==Cesium.SceneMode.SCENE3D){if(i._viewer.scene.camera.positionCartographic.height>1e5){o.alt=0}}i._lonlat=o;i._setLonLat()}},Cesium.ScreenSpaceEventType.MOUSE_MOVE);this._viewer.scene.postRender.addEventListener(function(){var e=i._viewer._lastHeight;var t=i._viewer.scene.canvas.height;var o=e-t;if(i._bottom_info){i._bottom_info.setAttribute("style","bottom: "+o+"px;")}})}e.prototype._loadBottomInfo=function(){var e=this;e._bottom_info=document.createElement("div");e._bottom_info.setAttribute("class","cfglobe-bottom-info");var t=document.createElement("div");t.setAttribute("id","cfglobe_bottom_info_left");t.setAttribute("class","cfglobe-bottom-info-left");e._bottom_info.appendChild(t);var o=document.createElement("div");o.setAttribute("id","cfglobe_bottom_info_right");o.setAttribute("class","cfglobe-bottom-info-right");o.setAttribute("title","点击切换显示类型");o.onclick=function(){e._showDFM=!e._showDFM;e._setLonLat()};e._bottom_info.appendChild(o);document.getElementById(e._globeId).getElementsByTagName("div")[0].appendChild(e._bottom_info)};e.prototype._setLonLat=function(){var e=this;var t=r.formatDegree(e._lonlat.lon);var o=r.formatDegree(e._lonlat.lat);if(t.f<10){t.f="0"+t.f}if(o.f<10){o.f="0"+o.f}var i=t.m.toFixed(2);if(i<10){i="0"+i}var n=o.m.toFixed(2);if(n<10){n="0"+n}var a=e.showScale();if(a==undefined){a="0 m"}if(e._showDFM){document.getElementById("cfglobe_bottom_info_right").innerHTML="比例尺："+a+"   "+" 经度："+t.d+"°"+t.f+"'"+i+'"；纬度：'+o.d+"°"+o.f+"'"+n+'"； 高程：'+parseInt(e._lonlat.alt)+"m"}else{document.getElementById("cfglobe_bottom_info_right").innerHTML="比例尺："+a+"   "+" 经度："+e._lonlat.lon.toFixed(4)+" ； 纬度："+e._lonlat.lat.toFixed(4)+"  ； 高程："+e._lonlat.alt.toFixed(2)}};e.prototype.showScale=function(){var e=this;var t=e._viewer.scene;var o=t.canvas.clientWidth;var i=t.canvas.clientHeight;var n=t.camera.getPickRay(new Cesium.Cartesian2(o/2|0,i-1));var a=t.camera.getPickRay(new Cesium.Cartesian2(1+o/2|0,i-1));var r=t.globe;var s=r.pick(n,t);var l=r.pick(a,t);if(!s||!l){return}var c=r.ellipsoid.cartesianToCartographic(s);var _=r.ellipsoid.cartesianToCartographic(l);e._geodesic.setEndPoints(c,_);var f=e._geodesic.surfaceDistance;var d=100;var m;for(var v=e._distances.length-1;!m&&v>=0;--v){if(e._distances[v]/f<d){m=e._distances[v]}}if(m){var h;if(m>=1e3){h=(m/1e3).toString()+" km"}else{h=m.toString()+" m"}return h}else{return}};e.prototype.setBottomInfo=function(e){var t=this;var o=t._globe.showScale();document.getElementById("cfglobe_bottom_info_left").innerHTML=o+"  "+e};return e});