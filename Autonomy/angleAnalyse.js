define([],function(){function e(e){var t=this;this._globe=e;this._viewer=e._viewer;this._globeId=e._globeId;this._angle_manager={draw:false,selectSpoint:false,spoint:null,epoint:null,subset:[]};this._handler=new Cesium.ScreenSpaceEventHandler(this._viewer.scene.canvas);this._handler.setInputAction(function(e){var a=t._globe.getLonLatByPosition(e.position);if(t._angle_manager.draw){if(t._angle_manager.selectSpoint){t._angle_manager.spoint=a;var n=t._viewer.entities.add({position:Cesium.Cartesian3.fromDegrees(a.lon,a.lat,a.alt),point:{color:Cesium.Color.RED,pixelSize:10,disableDepthTestDistance:Number.POSITIVE_INFINITY}});t._angle_manager.subset[t._angle_manager.subset.length]=n}else{t._angle_manager.epoint=a;t._drawAngleByPoints()}}},Cesium.ScreenSpaceEventType.LEFT_CLICK)}e.prototype.selectSpoint=function(){var e=this;e._angle_manager.draw=true;e._angle_manager.selectSpoint=true;e._angle_manager.spoint=null;e._angle_manager.epoint=null};e.prototype.selectEpoint=function(){var e=this;if(e._angle_manager.draw&&e._angle_manager.spoint){e._angle_manager.selectSpoint=false;e._angle_manager.epoint=null}else{alert("请先选取原点")}};e.prototype.clear=function(){var e=this;e._angle_manager.draw=false;e._angle_manager.selectSpoint=false;for(var a=e._angle_manager.subset.length-1;a>=0;a--){e._viewer.entities.remove(e._angle_manager.subset[a]);e._angle_manager.subset.pop()}};e.prototype._drawAngleByPoints=function(){var e=this;var a=e._angle_manager.spoint;var n=e._angle_manager.epoint;var t=CommonFunc.getAngle(a.lon,a.lat,n.lon,n.lat);var i=CommonFunc.destinationVincenty(a.lon,a.lat,a.alt,0,0,3e3);var r=Cesium.HorizontalOrigin.LEFT;var l=new Cesium.Cartesian2(10,0);var s=e._viewer.entities.add({position:Cesium.Cartesian3.fromDegrees(i.lon,i.lat,i.alt),point:{color:Cesium.Color.BLUE,pixelSize:10,disableDepthTestDistance:Number.POSITIVE_INFINITY},label:{text:"北",horizontalOrigin:Cesium.HorizontalOrigin.LEFT,pixelOffset:l,horizontalOrigin:r,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,font:"15pt Lucida Console",disableDepthTestDistance:Number.POSITIVE_INFINITY}});e._angle_manager.subset[e._angle_manager.subset.length]=s;var o=[i,a,n];var g=new Array;for(var _=0;_<o.length;_++){g.push(o[_].lon);g.push(o[_].lat);g.push(o[_].alt)}var m=Cesium.Cartesian3.fromDegreesArrayHeights(g);var u=e._viewer.entities.add({polyline:{positions:m,width:5,material:Cesium.Color.GREEN.withAlpha(1),disableDepthTestDistance:Number.POSITIVE_INFINITY}});e._angle_manager.subset[e._angle_manager.subset.length]=u;if(t>180){t=t-360}if(t<0){r=Cesium.HorizontalOrigin.RIGHT;l=new Cesium.Cartesian2(-10,0)}var p=e._viewer.entities.add({position:Cesium.Cartesian3.fromDegrees(n.lon,n.lat,n.alt),point:{color:Cesium.Color.BLUE,pixelSize:10,disableDepthTestDistance:Number.POSITIVE_INFINITY},label:{text:t.toFixed(2)+"°",pixelOffset:l,horizontalOrigin:r,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,font:"15pt Lucida Console",disableDepthTestDistance:Number.POSITIVE_INFINITY}});e._angle_manager.subset[e._angle_manager.subset.length]=p};return e});