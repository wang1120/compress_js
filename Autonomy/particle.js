define([],function(){function e(e){var i=this;this._globe=e;this._viewer=e._viewer;this._globeId=e._globeId;this._minHeight=0;this._maxHeight=1e6;this._catalog="default";this._subcatalog="default";this._layer=[];this._viewer.scene.postRender.addEventListener(function(){var e=0;var a=i._viewer.scene.mode;if(a==Cesium.SceneMode.SCENE3D){var r=Cesium.Cartographic.fromCartesian(i._viewer.scene.camera.position);e=r.height}else{e=Math.ceil(i._viewer.camera.positionCartographic.height)}for(var t=0;t<i._layer.length;t++){if(e>=i._layer[t].minHeight&&e<=i._layer[t].maxHeight){i._layer[t].showHeight=true}else{i._layer[t].showHeight=false}if(i._layer[t].showHeight&&i._layer[t].showLayer&&i._layer[t].showEntity){i._layer[t].show=true}else{i._layer[t].show=false}}})}e.prototype.add=function(e){var a=this;var r=e.mid?e.mid:"";var t=e.name?e.name:"default";var i=e.lon?parseFloat(e.lon):0;var l=e.lat?parseFloat(e.lat):0;var o=e.alt?parseFloat(e.alt):0;var s=e.catalog?e.catalog:a._catalog;var n=e.subcatalog?e.subcatalog:a._subcatalog;var m=e.minHeight?e.minHeight:a._minHeight;var h=e.maxHeight?e.maxHeight:a._maxHeight;var v=e.image?e.image:a._globe.urlConfig.PARTICLE_FIRE;var g=e.startScale?parseFloat(e.startScale):4;var _=e.endScale?parseFloat(e.endScale):6;var y=e.minimumLife?parseFloat(e.minimumLife):1;var u=e.maximumLife?parseFloat(e.maximumLife):1.5;var p=e.speed?parseFloat(e.speed):5;var c=e.width?parseInt(e.width):20;var f=e.height?parseInt(e.height):20;var d=e.lifeTime?parseFloat(e.lifeTime):16;var w=e.rate?parseFloat(e.rate):50;var C=e.emitter?parseFloat(e.emitter):45;var b=e.startColor?e.startColor:Cesium.Color.RED;var F=e.startAlpha?parseFloat(e.startAlpha):.7;var H=e.endColor?e.endColor:Cesium.Color.YELLOW;var L=e.endAlpha?parseFloat(e.endAlpha):.3;var x=a._viewer.scene.primitives.add(new Cesium.ParticleSystem({image:v,startScale:g,endScale:_,minimumLife:y,maximumLife:u,speed:p,width:c,height:f,lifeTime:d,startColor:b.withAlpha(F),endColor:H.withAlpha(L),rate:w,modelMatrix:Cesium.Transforms.eastNorthUpToFixedFrame(Cesium.Cartesian3.fromDegrees(i,l,o),undefined,new Cesium.Matrix4),emitter:new Cesium.ConeEmitter(Cesium.Math.toRadians(C))}));x.mid=r;x.name=t;x.catalog=s;x.subcatalog=n;x.minHeight=m;x.maxHeight=h;x.showHeight=true;x.showLayer=true;x.showEntity=true;a._layer[a._layer.length]=x;var M=(new Date).getTime()+"a"+parseInt(100*Math.random());a._globe.layerManager._add("entityLayer",M,s,n);return x};e.prototype.remove=function(e){var a=this;for(var r=a._layer.length-1;r>=0;r--){if(a._layer[r]==e){var t=a._layer[r].catalog;var i=a._layer[r].subcatalog;var l=a._viewer.scene.primitives.remove(e);a._layer.splice(r,1);a._globe.layerManager._remove("entityLayer",t,i);return l}}};e.prototype.removeByMid=function(e){var a=this;var r=true;for(var t=a._layer.length-1;t>=0;t--){if(a._layer[t].mid==e){var i=a._layer[t].catalog;var l=a._layer[t].subcatalog;r=a._viewer.scene.primitives.remove(a._layer[t]);a._layer.splice(t,1);a._globe.layerManager._remove("entityLayer",i,l);if(!r){return r}}}return r};e.prototype.removeByName=function(e){var a=this;var r=true;for(var t=a._layer.length-1;t>=0;t--){if(a._layer[t].name==e){var i=a._layer[t].catalog;var l=a._layer[t].subcatalog;r=a._viewer.scene.primitives.remove(a._layer[t]);a._layer.splice(t,1);a._globe.layerManager._remove("entityLayer",i,l);if(!r){return r}}}return r};e.prototype.getByMid=function(e){var a=this;var r=[];for(var t=a._layer.length-1;t>=0;t--){if(a._layer[t].mid==e){r[r.length]=a._layer[t]}}return r};e.prototype.getByName=function(e){var a=this;var r=[];for(var t=a._layer.length-1;t>=0;t--){if(a._layer[t].name==e){r[r.length]=a._layer[t]}}return r};return e});