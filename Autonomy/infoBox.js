define([],function(){function e(e){var o=this;this._nunid=0;this._globe=e;this._viewer=e._viewer;this._globeId=e._globeId;this._infoBoxList=[];this._loadInfoBox();this._viewer.scene.postRender.addEventListener(function(){o._positionPopUp()});this._handler=new Cesium.ScreenSpaceEventHandler(this._viewer.scene.canvas);this._handler.setInputAction(function(e){var t=o._viewer.scene.pick(e.position);if(Cesium.defined(t)){if(t.id){if(t.id._callback){t.id._callback(t.id)}}}},Cesium.ScreenSpaceEventType.LEFT_CLICK)}e.prototype._loadInfoBox=function(){var e=this;var t=document.createElement("div");t.setAttribute("id","cfglobe_infoBox");document.getElementById(e._globeId).getElementsByTagName("div")[0].appendChild(t)};e.prototype.build=function(e){var t=this;var o=e.width?parseInt(e.width):100;var i=e.height?parseInt(e.height):40;var n=e.top?parseInt(e.top):0;var r=e.left?parseInt(e.left):0;var a=e.src?e.src:"";var l=e.des?e.des:"";var s=e.title?e.title:"";var f=e.showClose!==false;var d=e.callback?e.callback:null;var c=e.beforeClose?e.beforeClose:null;var _=e.afterClose?e.afterClose:null;var v=e.lonlat?e.lonlat:null;var p=e.id?e.id:t._nunid;var u=e.background?e.background:null;if(!v){alert("位置信息不能为空！");return}var h=document.createElement("div");h.setAttribute("id","cfglobe_infoBox_"+p);var b=document.createElement("div");b.setAttribute("id","cfglobe_infoBox_content_"+p);b.setAttribute("class","cfglobe-infowindow");b.setAttribute("style","top:-"+n+"px;left:-"+r+"px;");h.appendChild(b);var B=document.createElement("div");B.setAttribute("style","background-color: white; color: black;");if(u){B.setAttribute("style","background:"+u)}b.appendChild(B);var g=document.createElement("div");g.setAttribute("class","cfglobe-infowindow-content");B.appendChild(g);var x=document.createElement("div");x.setAttribute("id","cfglobe_infoBox_des_"+p);x.setAttribute("style","width:"+o+"px;height:"+i+"px;");if(l){x.innerHTML=l}g.appendChild(x);document.getElementById("cfglobe_infoBox").appendChild(h);e.id=p;var m=t._viewer.scene.globe.ellipsoid;var C=Cesium.Cartographic.fromDegrees(v.lon,v.lat,v.alt);var L=m.cartographicToCartesian(C);e.position=L;e.beforeClose=c;e.afterClose=_;e.callback=d;t._infoBoxList[t._infoBoxList.length]=e;t._nunid++;t._positionPopUp();return e.id};e.prototype.reviseById=function(e,t,o,i){var n=this;for(var r=n._infoBoxList.length-1;r>=0;r--){if(n._infoBoxList[r].id==e){var a=document.getElementById("cfglobe_infoBox_des_"+e);if(o){a.style.width=o+"px"}if(i){a.style.height=i+"px"}var l=n._viewer.scene.globe.ellipsoid;var s=Cesium.Cartographic.fromDegrees(t.lon,t.lat,t.alt);var f=l.cartographicToCartesian(s);n._infoBoxList[r].position=f;n._positionPopUp()}}};e.prototype._remove=function(e){var t=this;var o=e.id.replace("cfglobe_infoBox_a_","");t.removeById(o)};e.prototype.removeById=function(e){var t=this;var o=-1;for(var i=t._infoBoxList.length-1;i>=0;i--){if(t._infoBoxList[i].id==e){o=i;break}}if(o>=0){if(t._infoBoxList[o].beforeClose){t._infoBoxList[o].beforeClose()}var n=document.getElementById("cfglobe_infoBox_"+e);if(n){document.getElementById("cfglobe_infoBox").removeChild(n)}if(t._infoBoxList[o].afterClose){t._infoBoxList[o].afterClose()}if(t._infoBoxList[o].callback){t._infoBoxList[o].callback()}t._infoBoxList.splice(o,1)}};e.prototype.removeAll=function(){var e=this;for(var t=e._infoBoxList.length-1;t>=0;t--){if(e._infoBoxList[t].beforeClose){e._infoBoxList[t].beforeClose()}var o=document.getElementById("cfglobe_infoBox_"+e._infoBoxList[t].id);if(o){document.getElementById("cfglobe_infoBox").removeChild(o)}if(e._infoBoxList[t].afterClose){e._infoBoxList[t].afterClose()}if(e._infoBoxList[t].callback){e._infoBoxList[t].callback()}e._infoBoxList.splice(t,1)}};e.prototype._positionPopUp=function(){var e=this;for(var t=0;t<e._infoBoxList.length;t++){var o=Cesium.SceneTransforms.wgs84ToWindowCoordinates(e._viewer.scene,e._infoBoxList[t].position);if(o){var i=document.getElementById("cfglobe_infoBox_content_"+e._infoBoxList[t].id);if(i){var n=o.x-i.offsetWidth/2;var r=o.y-i.offsetHeight;i.style.transform="translate3d("+Math.round(n)+"px, "+Math.round(r)+"px, 0)"}}}};return e});