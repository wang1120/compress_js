define([],function(){function e(e){var y=this;this._globe=e;this._viewer=e._viewer;this._globeId=e._globeId;this._minHeight=0;this._maxHeight=1e6;this._catalog="default";this._subcatalog="default";this._showMenu=true;this._layer={draw:false,drawid:"",layer:this._globe._defaultLayer,minHeight:0,maxHeight:1e6,catalog:"default",subcatalog:"default",mid:"",name:"default",callback:null,rightClick:null,subset:[]};this._viewer.scene.postRender.addEventListener(function(){var e=0;var a=y._viewer.scene.mode;if(a==Cesium.SceneMode.SCENE3D){var t=Cesium.Cartographic.fromCartesian(y._viewer.scene.camera.position);e=t.height}else{e=Math.ceil(y._viewer.camera.positionCartographic.height)}for(var r=0;r<y._layer.subset.length;r++){if(e>=y._layer.subset[r].minHeight&&e<=y._layer.subset[r].maxHeight){y._layer.subset[r].showHeight=true}else{y._layer.subset[r].showHeight=false}if(y._layer.subset[r].showHeight&&y._layer.subset[r].showLayer&&y._layer.subset[r].showEntity){for(var l=0;l<y._layer.subset[r].polygons.length;l++){y._layer.subset[r].polygons[l].polygon.show=true;y._layer.subset[r].polygons[l].polygonHat.show=true}}else{for(var l=0;l<y._layer.subset[r].polygons.length;l++){y._layer.subset[r].polygons[l].polygon.show=false;y._layer.subset[r].polygons[l].polygonHat.show=false}}}});this._handler=new Cesium.ScreenSpaceEventHandler(this._viewer.scene.canvas);this._handler.setInputAction(function(e){var a=y._globe.getLonLatByPosition(e.position);if(y._layer.draw){if(a.alt<0){a.alt=0}var t=Cesium.Cartographic.fromCartesian(y._viewer.scene.camera.position);m_alt=t.height;if(true){if(y._layer.drawid==""){var r={id:"newisolationBelt",layer:y._layer.layer,catalog:y._layer.catalog,subcatalog:y._layer.subcatalog,minHeight:y._layer.minHeight,maxHeight:y._layer.maxHeight,showHeight:true,showLayer:true,showEntity:true,mid:y._layer.mid,name:y._layer.name,callback:y._layer.callback,polygons:[],points:[]};y._layer.subset.push(r);y._layer.drawid="newisolationBelt";var l=(new Date).getTime()+"a"+parseInt(100*Math.random());y._globe.layerManager._add("entityLayer",l,y._layer.catalog,y._layer.subcatalog)}var i;for(var n=0;n<y._layer.subset.length;n++){if(y._layer.subset[n].id==y._layer.drawid){i=y._layer.subset[n];break}}var o={lon:a.lon,lat:a.lat,alt:a.alt};i.points.push(o);if(i.points.length==1){var s={};s.vertexList=[];s.vertexListHat=[];s.polygon=y._viewer.entities.add({rightClick:y._layer.rightClick,mid:y._layer.mid,name:y._layer.name,polygon:{hierarchy:new Cesium.CallbackProperty(function(){return s.vertexList},false),material:Cesium.Color.WHITE.withAlpha(1)}});s.polygonHat=y._viewer.entities.add({rightClick:y._layer.rightClick,mid:y._layer.mid,name:y._layer.name,polygon:{hierarchy:new Cesium.CallbackProperty(function(){return s.vertexListHat},false),material:Cesium.Color.WHITE.withAlpha(1)}});i.polygons.push(s);y._layer.drawid=i.id=s.polygon.id}else{var s={};s.vertexList=[];s.vertexListHat=[];s.polygon=y._viewer.entities.add({rightClick:y._layer.rightClick,mid:y._layer.mid,name:y._layer.name,polygon:{hierarchy:new Cesium.CallbackProperty(function(){return s.vertexList},false),material:Cesium.Color.WHITE.withAlpha(1)}});s.polygonHat=y._viewer.entities.add({rightClick:y._layer.rightClick,mid:y._layer.mid,name:y._layer.name,polygon:{hierarchy:new Cesium.CallbackProperty(function(){return s.vertexListHat},false),material:Cesium.Color.WHITE.withAlpha(1)}});i.polygons.push(s)}}else{if(y._layer.callback)y._layer.callback(null);y._layer.draw=false;y._layer.drawid=""}}},Cesium.ScreenSpaceEventType.LEFT_CLICK);this._handler.setInputAction(function(e){var a=y._globe.getLonLatByPosition(e.position);if(a.alt<0){a.alt=0}var t={lon:a.lon,lat:a.lat,alt:a.alt};if(y._layer.draw){var r;for(var l=0;l<y._layer.subset.length;l++){if(y._layer.subset[l].id==y._layer.drawid){r=y._layer.subset[l];r.points.push(t);break}}y._layer.drawid="";if(r.callback){r.callback(r)}}},Cesium.ScreenSpaceEventType.RIGHT_CLICK);this._handler.setInputAction(function(e){var a=y._globe.getLonLatByPosition(e.endPosition);if(y._layer.draw&&y._layer.drawid!=""){var t;for(var r=0;r<y._layer.subset.length;r++){if(y._layer.subset[r].id==y._layer.drawid){t=y._layer.subset[r];break}}if(t.points.length>0){if(a.alt<0){a.alt=0}var l={lon:a.lon,lat:a.lat,alt:a.alt};var i=[];i.push(t.points[t.points.length-1]);i.push(l);var n=y.getPointList(i);t.polygons[t.polygons.length-1].vertexList=Cesium.Cartesian3.fromDegreesArrayHeights(n.vertexList);t.polygons[t.polygons.length-1].vertexListHat=Cesium.Cartesian3.fromDegreesArrayHeights(n.vertexListHat)}}},Cesium.ScreenSpaceEventType.MOUSE_MOVE)}e.prototype.getPointList=function(e){var a=this;var t=2e3;var r=20;var l=50;var i=300;var n=[];var o=[];var s=[];var y=[];if(e.length<2){return{vertexList:[],vertexListHat:[]}}else if(e.length==2){var g={lon:e[0].lon,lat:e[0].lat,alt:t};var u={lon:e[1].lon,lat:e[1].lat,alt:t};var _=[];var h=a._globe.commonFunc.getDistance(g.lon,g.lat,u.lon,u.lat);var c=a._globe.commonFunc.getAngle(g.lon,g.lat,u.lon,u.lat);var v=g;var m=a._globe.commonFunc.destinationVincenty(g.lon,g.lat,t,c+90,0,r);var p=a._globe.commonFunc.destinationVincenty(m.lon,m.lat,t,c,0,r);var b=a._globe.commonFunc.destinationVincenty(p.lon,p.lat,t,c+90,0,l);var d=a._globe.commonFunc.destinationVincenty(g.lon,g.lat,t,c+90,0,l+r*2);n.push(v);o.push(m);o.push(p);s.push(m);s.push(p);s.push(b);y.push(d);if(h<100){_=[]}else if(h<i*2){var f=a._globe.commonFunc.destinationVincenty(g.lon,g.lat,t,c,0,h/2);_.push(f)}else{var w=parseInt((h-200)/i);var C=h-i*w;var H=C/2;var L=Cesium.Cartesian3.fromDegrees(g.lon,g.lat,t);var k=Cesium.Cartesian3.fromDegrees(u.lon,u.lat,t);var x=new Cesium.Cartesian3;Cesium.Cartesian3.subtract(k,L,x);Cesium.Cartesian3.normalize(x,x);var M=new Cesium.Ray(L,x);for(var E=0;E<=w;E++){var F=H+i*E;var I=Cesium.Ray.getPoint(M,F);var A=Cesium.Cartographic.fromCartesian(I);var T=Cesium.Math.toDegrees(A.longitude);var V=Cesium.Math.toDegrees(A.latitude);var P=A.height;var f={lon:T,lat:V,alt:P};_.push(f)}}for(var E=0;E<_.length;E++){var D=_[E];var S=a._globe.commonFunc.destinationVincenty(D.lon,D.lat,t,c+90,0,l+r);var B=a._globe.commonFunc.destinationVincenty(S.lon,S.lat,t,c-180,0,r);var W=a._globe.commonFunc.destinationVincenty(S.lon,S.lat,t,c-90,0,l);var R=a._globe.commonFunc.destinationVincenty(S.lon,S.lat,t,c,0,r);var N=a._globe.commonFunc.destinationVincenty(S.lon,S.lat,t,c+90,0,r);n.push(D);o.push(W);s.push(B);s.push(W);s.push(R);y.push(N)}var K=u;var O=a._globe.commonFunc.destinationVincenty(u.lon,u.lat,t,c+90,0,r);var z=a._globe.commonFunc.destinationVincenty(O.lon,O.lat,t,c-180,0,r);var G=a._globe.commonFunc.destinationVincenty(z.lon,z.lat,t,c+90,0,l);var U=a._globe.commonFunc.destinationVincenty(u.lon,u.lat,t,c+90,0,l+r*2);n.push(K);o.push(z);o.push(O);s.push(G);s.push(z);s.push(O);y.push(U);var j=[];for(var q=0;q<s.length;q++){j.push(s[q])}for(var q=y.length-1;q>=0;q--){j.push(y[q])}var J=new Array;for(var q=0;q<j.length;q++){J.push(j[q].lon);J.push(j[q].lat);J.push(j[q].alt)}var Q=[];for(var q=0;q<n.length;q++){Q.push(n[q])}for(var q=o.length-1;q>=0;q--){Q.push(o[q])}var X=new Array;for(var q=0;q<Q.length;q++){X.push(Q[q].lon);X.push(Q[q].lat);X.push(Q[q].alt)}return{vertexList:J,vertexListHat:X}}else{return{vertexList:[],vertexListHat:[]}}};e.prototype.add=function(e){var l=this;var i=e.mid?e.mid:"";var n=e.name?e.name:"default";var a=e.rightClick?e.rightClick:null;var o=e.pointList?e.pointList:[];var t=e.layer?e.layer:l._globe._defaultLayer;var r=e.catalog?e.catalog:l._catalog;var s=e.subcatalog?e.subcatalog:l._subcatalog;var y=e.minHeight?e.minHeight:l._minHeight;var g=e.maxHeight?e.maxHeight:l._maxHeight;var u={layer:t,catalog:r,subcatalog:s,minHeight:y,maxHeight:g,showHeight:true,showLayer:true,showEntity:true,mid:i,name:n,callback:null,polygons:[],points:o};for(var _=0;_<o.length-1;_++){(function(e){var a={};a.vertexList=[];a.vertexListHat=[];var t=[];t.push(o[e]);t.push(o[e+1]);var r=l.getPointList(t);a.vertexList=Cesium.Cartesian3.fromDegreesArrayHeights(r.vertexList);a.vertexListHat=Cesium.Cartesian3.fromDegreesArrayHeights(r.vertexListHat);a.polygon=l._viewer.entities.add({rightClick:l._layer.rightClick,mid:i,name:n,polygon:{hierarchy:new Cesium.CallbackProperty(function(){return a.vertexList},false),material:Cesium.Color.WHITE.withAlpha(1)}});a.polygonHat=l._viewer.entities.add({rightClick:l._layer.rightClick,mid:i,name:n,polygon:{hierarchy:new Cesium.CallbackProperty(function(){return a.vertexListHat},false),material:Cesium.Color.WHITE.withAlpha(1)}});u.polygons.push(a);if(e==0){u.id=a.polygon.id}})(_)}l._layer.push(u);var h=(new Date).getTime()+"a"+parseInt(100*Math.random());l._globe.layerManager._add("entityLayer",h,r,s);return u};e.prototype.drawHandler=function(e){var a=this;var t=e.mid?e.mid:"";var r=e.name?e.name:"default";var l=e.callback?e.callback:null;var i=e.rightClick?e.rightClick:null;var n=e.layer?e.layer:a._globe._defaultLayer;var o=e.catalog?e.catalog:a._catalog;var s=e.subcatalog?e.subcatalog:a._subcatalog;var y=e.minHeight?e.minHeight:a._minHeight;var g=e.maxHeight?e.maxHeight:a._maxHeight;a._layer.draw=true;a._layer.drawid="";a._layer.mid=t;a._layer.name=r;a._layer.callback=l;a._layer.rightClick=i;a._layer.layer=n;a._showMenu=a._globe.globeMenu._showMenu;a._layer.catalog=o;a._layer.subcatalog=s;a._layer.minHeight=y;a._layer.maxHeight=g;a._globe.globeMenu.setType(false)};e.prototype.deactivateHandler=function(){var e=this;e._layer.draw=false;e._layer.drawid="";e._layer.mid="";e._layer.name="default";e._layer.callback=null;e._layer.layer=e._globe._defaultLayer;e._layer.catalog=e._catalog;e._layer.subcatalog=e._subcatalog;e._layer.minHeight=e._minHeight;e._layer.maxHeight=e._maxHeight;e._globe.globeMenu.setType(e._showMenu)};e.prototype.remove=function(e){var a=this;var t;for(var r=a._layer.subset.length-1;r>=0;r--){if(a._layer.subset[r].id==e.id){var l=a._layer.subset[r].catalog;var i=a._layer.subset[r].subcatalog;for(var n=a._layer.subset[r].polygons.length-1;n>=0;n--){t=a._viewer.entities.remove(a._layer.subset[r].polygons[n].polygon);t=a._viewer.entities.remove(a._layer.subset[r].polygons[n].polygonHat);if(!t){break}}if(!t){break}a._layer.subset.splice(r,1);a._globe.layerManager._remove("entityLayer",l,i)}}a._layer.draw=false;a._layer.name="default";a._layer.drawid="";a._layer.callback=null;a._layer.layer=a._globe._defaultLayer;a._layer.catalog=a._catalog;a._layer.subcatalog=a._subcatalog;a._layer.minHeight=a._minHeight;a._layer.maxHeight=a._maxHeight;return t};e.prototype.removeByMid=function(e){var a=this;var t=true;for(var r=a._layer.subset.length-1;r>=0;r--){if(a._layer.subset[r].mid==e){var l=a._layer.subset[r].catalog;var i=a._layer.subset[r].subcatalog;for(var n=a._layer.subset[r].polygons.length-1;n>=0;n--){t=a._viewer.entities.remove(a._layer.subset[r].polygons[n].polygon);t=a._viewer.entities.remove(a._layer.subset[r].polygons[n].polygonHat);if(!t){break}}if(!t){break}a._layer.subset.splice(r,1);a._globe.layerManager._remove("entityLayer",l,i)}}a._layer.draw=false;a._layer.name="default";a._layer.drawid="";a._layer.callback=null;a._layer.layer=a._globe._defaultLayer;a._layer.catalog=a._catalog;a._layer.subcatalog=a._subcatalog;a._layer.minHeight=a._minHeight;a._layer.maxHeight=a._maxHeight;return t};e.prototype.removeByName=function(e){var a=this;var t=true;for(var r=a._layer.subset.length-1;r>=0;r--){if(a._layer.subset[r].name==e){var l=a._layer.subset[r].catalog;var i=a._layer.subset[r].subcatalog;for(var n=a._layer.subset[r].polygons.length-1;n>=0;n--){t=a._viewer.entities.remove(a._layer.subset[r].polygons[n].polygon);t=a._viewer.entities.remove(a._layer.subset[r].polygons[n].polygonHat);if(!t){break}}if(!t){break}a._layer.subset.splice(r,1);a._globe.layerManager._remove("entityLayer",l,i)}}a._layer.draw=false;a._layer.name="default";a._layer.drawid="";a._layer.callback=null;a._layer.layer=a._globe._defaultLayer;a._layer.catalog=a._catalog;a._layer.subcatalog=a._subcatalog;a._layer.minHeight=a._minHeight;a._layer.maxHeight=a._maxHeight;return t};e.prototype.getByMid=function(e){var a=this;var t=[];for(var r=a._layer.subset.length-1;r>=0;r--){if(a._layer.subset[r].mid==e){t.push(a._layer.subset[r])}}return t};e.prototype.getByName=function(e){var a=this;var t=[];for(var r=a._layer.subset.length-1;r>=0;r--){if(a._layer.subset[r].name==e){t.push(a._layer.subset[r])}}return t};return e});