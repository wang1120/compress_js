define([],function(){function e(e){var f=this;this._globe=e;this._viewer=e._viewer;this._globeId=e._globeId;this._minHeight=0;this._maxHeight=1e6;this._catalog="default";this._subcatalog="default";this._handler=new Cesium.ScreenSpaceEventHandler(this._viewer.scene.canvas);this._layer=[];this._showMenu=true;this._options={draw:false,minHeight:0,maxHeight:1e6,catalog:"default",subcatalog:"default",drawid:"",handlerCallback:null,options:null};this._viewer.scene.postRender.addEventListener(function(){var e=0;var a=f._viewer.scene.mode;if(a==Cesium.SceneMode.SCENE3D){var r=Cesium.Cartographic.fromCartesian(f._viewer.scene.camera.position);e=r.height}else{e=Math.ceil(f._viewer.camera.positionCartographic.height)}for(var i=0;i<f._layer.length;i++){if(e>=f._layer[i].minHeight&&e<=f._layer[i].maxHeight){f._layer[i].showHeight=true}else{f._layer[i].showHeight=false}if(f._layer[i].showHeight&&f._layer[i].showLayer&&f._layer[i].showEntity){f._layer[i].circle.show=true}else{f._layer[i].circle.show=false}}});this._handler.setInputAction(function(e){var a=f._globe.getLonLatByPosition(e.position);if(f._options.draw&&f._options.drawid==""){var r={};for(var i in f._options.options){if(i!="color"&&i!="layer"){r[i]=typeof f._options.options[i]==="object"?deepCoyp(f._options.options[i]):f._options.options[i]}}var t=r.mid?r.mid:"";var o=r.name?r.name:"";var l=r.width?r.width:3;var n=r.wlpha?r.wlpha:.5;var s=r.rightClick?r.rightClick:null;var c=r.catalog?r.catalog:f._catalog;var h=r.subcatalog?r.subcatalog:f._subcatalog;var g=r.minHeight?r.minHeight:f._minHeight;var _=r.maxHeight?r.maxHeight:f._maxHeight;var p=f._options.options.color?f._options.options.color:Cesium.Color.BLUE;var u=f._options.options.layer?f._options.options.layer:f._globe._defaultLayer;var m=f._options.options.clampMode?f._options.options.clampMode:0;var v=[a];var d={circle:null,pointList:v,radius:null,layer:u,options:r,catalog:c,subcatalog:h,minHeight:g,maxHeight:_,showHeight:true,showLayer:true,showEntity:true,clampMode:m};if(m==0){d.circle=f._viewer.entities.add({position:Cesium.Cartesian3.fromDegrees(a.lon,a.lat),mid:t,name:o,rightClick:s,ellipse:{semiMinorAxis:new Cesium.CallbackProperty(function(){return d.radius},false),semiMajorAxis:new Cesium.CallbackProperty(function(){return d.radius},false),height:2e3,material:p.withAlpha(n)}})}else{d.circle=f._viewer.entities.add({position:Cesium.Cartesian3.fromDegrees(a.lon,a.lat),mid:t,name:o,rightClick:s,ellipse:{semiMinorAxis:new Cesium.CallbackProperty(function(){return d.radius},false),semiMajorAxis:new Cesium.CallbackProperty(function(){return d.radius},false),material:p.withAlpha(n)}})}f._layer.push(d);f._options.drawid=d.circle.id;var y=(new Date).getTime()+"a"+parseInt(100*Math.random());f._globe.layerManager._add("entityLayer",y,c,h)}},Cesium.ScreenSpaceEventType.LEFT_CLICK);this._handler.setInputAction(function(e){var a=f._globe.getLonLatByPosition(e.endPosition);if(f._options.draw&&f._options.drawid!=""){var r=f._layer[f._layer.length-1].pointList.slice(0);var i=Cesium.Cartesian3.fromDegrees(r[r.length-1].lon,r[r.length-1].lat);var t=Cesium.Cartesian3.fromDegrees(a.lon,a.lat);var o=Cesium.Cartesian3.distance(i,t);f._layer[f._layer.length-1].radius=o}},Cesium.ScreenSpaceEventType.MOUSE_MOVE);this._handler.setInputAction(function(e){var a=f._globe.getLonLatByPosition(e.position);if(a.alt<0){a.alt=0}if(f._options.draw&&f._options.drawid!=""){f._layer[f._layer.length-1].pointList.push(a);var r=f._layer[f._layer.length-1].pointList.slice(0);var i=Cesium.Cartesian3.fromDegrees(r[r.length-2].lon,r[r.length-2].lat);var t=Cesium.Cartesian3.fromDegrees(r[r.length-1].lon,r[r.length-1].lat);var o=Cesium.Cartesian3.distance(i,t);f._layer[f._layer.length-1].radius=o;f._options.drawid="";if(f._options.handlerCallback)f._options.handlerCallback(f._layer[f._layer.length-1])}},Cesium.ScreenSpaceEventType.RIGHT_CLICK)}e.prototype.drawHandler=function(e){var a=this;a._options.draw=true;a._options.drawid="";a._options.options=e;var r=e.handlerCallback?e.handlerCallback:null;a._options.handlerCallback=r;a._showMenu=a._globe.globeMenu._showMenu;a._globe.globeMenu.setType(false)};e.prototype.add=function(e){var a=this;var r=e.mid?e.mid:"";var i=e.name?e.name:"";var t=e.width?parseInt(e.width):3;var o=e.wlpha?parseFloat(e.wlpha):1;var l=e.rightClick?e.rightClick:null;var n=e.color?e.color:Cesium.Color.BLUE;var s=e.pointList?e.pointList:[];var c=e.layer?e.layer:a._globe._defaultLayer;var h=e.catalog?e.catalog:a._catalog;var g=e.subcatalog?e.subcatalog:a._subcatalog;var _=e.minHeight?e.minHeight:a._minHeight;var p=e.maxHeight?e.maxHeight:a._maxHeight;var u=e.clampMode?e.clampMode:0;var m=Cesium.Cartesian3.fromDegrees(s[0].lon,s[0].lat);var v=Cesium.Cartesian3.fromDegrees(s[1].lon,s[1].lat);var d=Cesium.Cartesian3.distance(m,v);var y={circle:null,pointList:s,radius:d,layer:c,catalog:h,subcatalog:g,minHeight:_,maxHeight:p,showHeight:true,showLayer:true,showEntity:true,options:e,clampMode:u};y.circle=a._viewer.entities.add({position:Cesium.Cartesian3.fromDegrees(s[0].lon,s[0].lat),name:i,mid:r,rightClick:l,ellipse:{semiMinorAxis:d,semiMajorAxis:d,material:n.withAlpha(o)}});a._layer.push(y);var f=(new Date).getTime()+"a"+parseInt(100*Math.random());a._globe.layerManager._add("entityLayer",f,h,g);return y};e.prototype.addByRadius=function(e){var a=this;var r=e.mid?e.mid:"";var i=e.name?e.name:"";var t=e.width?parseInt(e.width):3;var o=e.wlpha?parseFloat(e.wlpha):1;var l=e.rightClick?e.rightClick:null;var n=e.color?e.color:Cesium.Color.BLUE;var s=e.point?e.point:"";var c=e.radius?e.radius:"";var h=e.layer?e.layer:a._globe._defaultLayer;var g=e.catalog?e.catalog:a._catalog;var _=e.subcatalog?e.subcatalog:a._subcatalog;var p=e.minHeight?e.minHeight:a._minHeight;var u=e.maxHeight?e.maxHeight:a._maxHeight;var m=e.clampMode?e.clampMode:0;var v=e.callback?e.callback:"";var d={circle:null,point:s,radius:c,layer:h,catalog:g,subcatalog:_,minHeight:p,maxHeight:u,showHeight:true,showLayer:true,showEntity:true,options:e,clampMode:m};d.circle=a._viewer.entities.add({position:Cesium.Cartesian3.fromDegrees(s.lon,s.lat),name:i,mid:r,rightClick:l,ellipse:{semiMinorAxis:c,semiMajorAxis:c,material:n.withAlpha(o)}});a._layer.push(d);var y=(new Date).getTime()+"a"+parseInt(100*Math.random());a._globe.layerManager._add("entityLayer",y,g,_);if(v)v(d);return d};e.prototype.deactivateHandler=function(){var e=this;e._options.draw=false;e._globe.globeMenu.setType(e._showMenu)};e.prototype.remove=function(e){var a=this;for(var r=a._layer.length-1;r>=0;r--){if(a._layer[r].circle==e){var i=a._layer[r].catalog;var t=a._layer[r].subcatalog;var o=a._viewer.entities.remove(e);a._globe.layerManager._remove("entityLayer",i,t);a._layer.splice(r,1);return o}}};e.prototype.removeByMid=function(e){var a=this;var r=true;for(var i=a._layer.length-1;i>=0;i--){if(a._layer[i].circle.mid==e){var t=a._layer[i].catalog;var o=a._layer[i].subcatalog;r=a._viewer.entities.remove(a._layer[i].circle);a._globe.layerManager._remove("entityLayer",t,o);a._layer.splice(i,1);if(!r){return r}}}return r};e.prototype.removeByName=function(e){var a=this;var r=true;for(var i=a._layer.length-1;i>=0;i--){if(a._layer[i].circle.name==e){var t=a._layer[i].catalog;var o=a._layer[i].subcatalog;r=a._viewer.entities.remove(a._layer[i].circle);a._globe.layerManager._remove("entityLayer",t,o);a._layer.splice(i,1);if(!r){return r}}}return r};e.prototype.getByMid=function(e){var a=this;var r=[];for(var i=a._layer.length-1;i>=0;i--){if(a._layer[i].circle.mid==e){r[r.length]=a._layer[i].circle}}return r};e.prototype.getByName=function(e){var a=this;var r=[];for(var i=a._layer.length-1;i>=0;i--){if(a._layer[i].circle.name==e){r[r.length]=a._layer[i].circle}}return r};return e});